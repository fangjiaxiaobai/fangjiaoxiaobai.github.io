<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>方家小白 • Posts by &#34;k8s&#34; category</title>
        <link>https://fangjiaxiaobai.github.io</link>
        <description>和你一起遇见更好的自己</description>
        <language>zh-CN</language>
        <pubDate>Mon, 19 Sep 2022 18:18:00 +0800</pubDate>
        <lastBuildDate>Mon, 19 Sep 2022 18:18:00 +0800</lastBuildDate>
        <category>全站地图</category>
        <category>目录</category>
        <category>源码</category>
        <category>日常</category>
        <category>Springboot</category>
        <category>Netty</category>
        <category>雪花算法</category>
        <category>算法</category>
        <category>MySQL</category>
        <category>高效工作,快乐生活</category>
        <category>Redis</category>
        <category>数据结构</category>
        <category>Elastic Search</category>
        <category>搜索</category>
        <category>youtube</category>
        <category>gpu</category>
        <category>go</category>
        <category>go-error</category>
        <category>BiliBili</category>
        <category>MachineLearn</category>
        <category>git</category>
        <category>log</category>
        <category>go-log</category>
        <category>k8s</category>
        <category>kubernetes</category>
        <category>猫影视</category>
        <category>RocketMQ</category>
        <category>消息队列</category>
        <category>线程池</category>
        <category>面经</category>
        <category>图片</category>
        <category>日拱一卒</category>
        <category>leetCode</category>
        <category>链表</category>
        <category>面经之算法题</category>
        <category>数组</category>
        <category>不做也罢的算法题</category>
        <category>动态规划</category>
        <category>有点难的算法题</category>
        <category>HD</category>
        <category>BQ</category>
        <category>AC</category>
        <category>HashMap</category>
        <category>JDK</category>
        <category>JDK8</category>
        <category>String</category>
        <category>数据结构与算法</category>
        <category>霍夫曼编码</category>
        <category>哈夫曼编码</category>
        <category>C++</category>
        <category>排序</category>
        <category>冒泡排序</category>
        <category>交换排序</category>
        <category>分治思想排序</category>
        <category>快速排序</category>
        <category>分支思想排序</category>
        <category>选择排序</category>
        <category>桶排序</category>
        <category>线性思想排序</category>
        <category>递归</category>
        <category>go-设计模式</category>
        <category>哈希算法</category>
        <category>模型评估</category>
        <category>Java</category>
        <category>dubbo</category>
        <category>架构</category>
        <category>笔记</category>
        <category>go-runtimes</category>
        <category>KNN</category>
        <category>JDK版本</category>
        <category>JDK11</category>
        <category>OOM</category>
        <category>JVM</category>
        <category>Stream</category>
        <item>
            <guid isPermalink="true">https://fangjiaxiaobai.github.io/2022/09/19/k8s/seris100-kuboard/</guid>
            <title>k8s 监控神器 kuboard</title>
            <link>https://fangjiaxiaobai.github.io/2022/09/19/k8s/seris100-kuboard/</link>
            <category>k8s</category>
            <category>kubernetes</category>
            <pubDate>Mon, 19 Sep 2022 18:18:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;code&gt;Kubernetes&lt;/code&gt;  容器编排已越来越被大家关注，然而学习  &lt;code&gt;Kubernetes&lt;/code&gt;  的门槛却依然很高，主要体现在这几个方面：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;集群的安装复杂&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Kubernetes&lt;/code&gt;  相较于容器，引入了许多新的概念&lt;/li&gt;
&lt;li&gt;需要手工编写  &lt;code&gt;YAML&lt;/code&gt;  文件&lt;/li&gt;
&lt;li&gt;没有好的参考案例可以遵循&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;今天给大家介绍的这款工具  &lt;code&gt;Kuboard&lt;/code&gt; ，是一款免费的  &lt;code&gt;Kubernetes&lt;/code&gt;  图形化管理工具， &lt;code&gt;Kuboard&lt;/code&gt;  力图帮助用户快速在  &lt;code&gt;Kubernetes&lt;/code&gt;  上落地微服务。为了达到此目标， &lt;code&gt;Kuboard&lt;/code&gt;  提供了针对上述问题的解决办法：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Kuboard&lt;/code&gt;  提供  &lt;code&gt;Kubernetes&lt;/code&gt;  免费安装文档、免费在线答疑，每天约有  &lt;code&gt;200&lt;/code&gt;  位网友参照  &lt;code&gt;Kuboard&lt;/code&gt;  提供的文档进行 K8S 集群安装。&lt;br&gt;
 &lt;code&gt;Kuboard&lt;/code&gt;  提供  &lt;code&gt;Kubernetes&lt;/code&gt;  免费中文教程、用户无需付费购买视频教程或参加线下培训班，就可参照  &lt;code&gt;Kuboard&lt;/code&gt;  提供的免费教程完成  &lt;code&gt;K8S&lt;/code&gt;  的学习，更有  &lt;code&gt;QQ&lt;/code&gt;  社群可以和网友互相讨论，共同进步。&lt;br&gt;
 &lt;code&gt;Kuboard&lt;/code&gt;  是  &lt;code&gt;Kubernetes&lt;/code&gt;  的一款图形化管理工具，使用 Kuboard，用户无需编写  &lt;code&gt;YAML&lt;/code&gt;  文件，就可以完成应用程序的部署和管理。&lt;br&gt;
 &lt;code&gt;Kuboard&lt;/code&gt;  提供  &lt;code&gt;Spring Cloud&lt;/code&gt;  等微服务参考架构在  &lt;code&gt;K8S&lt;/code&gt;  上的详细部署文档和步骤，是  &lt;code&gt;Spring Cloud&lt;/code&gt;  用户将自己的应用迁移到  &lt;code&gt;K8S&lt;/code&gt;  部署环境的非常好的参考资料。&lt;br&gt;
 &lt;code&gt;Kuboard&lt;/code&gt;  是一款专为  &lt;code&gt;Kubernetes&lt;/code&gt;  设计的免费管理界面，兼容  &lt;code&gt;Kubernetes&lt;/code&gt;  版本  &lt;code&gt;1.13&lt;/code&gt;  及以上。 &lt;code&gt;Kuboard&lt;/code&gt;  每周发布一个  &lt;code&gt;beta&lt;/code&gt;  版本，最长每月发布一个正式版本，经过两年的不断迭代和优化，已经具备多集群管理、权限管理、监控套件、日志套件等丰富的功能，并且有  &lt;code&gt;1000+&lt;/code&gt;  的企业将  &lt;code&gt;Kuboard&lt;/code&gt;  应用于其生产环境。 &lt;code&gt;Kuboard&lt;/code&gt;  自  &lt;code&gt;2019年8月&lt;/code&gt; 发布第一个版本以来，得到了众多用户的认可，目前已经获得了  &lt;code&gt;10000+ GitHub Star&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;安装&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装&#34;&gt;#&lt;/a&gt; 安装&lt;/h2&gt;
&lt;h3 id=&#34;给-master-节点添加标签&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#给-master-节点添加标签&#34;&gt;#&lt;/a&gt; 给  &lt;code&gt;master&lt;/code&gt;  节点添加标签.&lt;/h3&gt;
&lt;p&gt;首先查看一下  &lt;code&gt;master&lt;/code&gt;  节点是否有  &lt;code&gt;&amp;quot;k8s.kuboard.cn/role=etcd&amp;quot;&lt;/code&gt;  标签:&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl get nodes --show-labels=true&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果有则进行下一步.&lt;br&gt;
 如果没有，添加标签:&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl label nodes k8s-master-01 k8s.kuboard.cn/role=etcd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中 将  &lt;code&gt;k8s-master-01&lt;/code&gt;  替换成你的 &lt;code&gt;master&lt;/code&gt;  节点。&lt;/p&gt;
&lt;h3 id=&#34;安装-kuboard&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装-kuboard&#34;&gt;#&lt;/a&gt; 安装 kuboard.&lt;/h3&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl create -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后查看启动情况&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[root@k8s-master-01 yamls]# kubectl get pod -n kuboard&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;NAME                               READY   STATUS    RESTARTS      AGE&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kuboard-agent-2-8644cd44c9-wdq5h   1/1     Running   2 (21m ago)   22m&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kuboard-agent-8467cc9799-2n4wl     1/1     Running   0             9m5s&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kuboard-agent-8467cc9799-p9qb6     1/1     Running   2 (21m ago)   22m&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kuboard-etcd-pmdxq                 1/1     Running   0             22m&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kuboard-v3-84f9bf8bfc-8gt5z        1/1     Running   0             22m&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;都启动成功之后。&lt;/p&gt;
&lt;p&gt;通过浏览器访问  &lt;code&gt;&amp;lt;MasterIp&amp;gt;:30080&lt;/code&gt;  即可。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/mages/k8s/10-01.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;页面操作&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#页面操作&#34;&gt;#&lt;/a&gt; 页面操作&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Kuboard&lt;/code&gt;  是一款专为  &lt;code&gt;Kubernetes&lt;/code&gt;  设计的免费管理界面，兼容  &lt;code&gt;Kubernetes&lt;/code&gt;  版本  &lt;code&gt;1.13&lt;/code&gt;  及以上。  &lt;code&gt;Kuboard&lt;/code&gt;  已经具备多集群管理、权限管理、监控套件、日志套件等丰富的功能.&lt;/p&gt;
&lt;h3 id=&#34;多集群管理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#多集群管理&#34;&gt;#&lt;/a&gt; 多集群管理&lt;/h3&gt;
&lt;p&gt;管理员可以把 不同的 &lt;code&gt;Kubernetes&lt;/code&gt;  集群添加同一个 &lt;code&gt;Kuboard&lt;/code&gt;  中， 并且可以分配不同的权限进行控制，将不同集群 / 名称空间的权限分配给指定的用户或用户组。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/mages/k8s/10-02.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;微服务分层展示&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#微服务分层展示&#34;&gt;#&lt;/a&gt; 微服务分层展示&lt;/h3&gt;
&lt;p&gt;在  &lt;code&gt;Kuboard&lt;/code&gt;  的名称空间概要页中，以经典的微服务分层方式将工作负载划分到不同的分层，更加直观地展示微服务架构的结构，并且可以为每一个名称空间自定义名称空间布局。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/mages/k8s/10-03.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;进入命名空间之后，可以查看各种资源信息。还支持各种常用操作。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/mages/k8s/10-04.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;附录-kuboard-v3安装文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#附录-kuboard-v3安装文件&#34;&gt;#&lt;/a&gt; 附录 - kuboard-v3 安装文件&lt;/h2&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;206&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;207&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;208&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;209&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;210&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;211&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;212&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;213&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;214&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;215&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;216&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;217&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;218&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;219&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;220&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;221&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;222&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;223&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;224&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;225&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;226&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;227&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;228&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;229&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;230&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;231&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;232&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;233&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;234&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;235&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;237&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;238&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;239&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;240&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;241&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;242&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;243&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;244&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;245&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;246&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;247&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;248&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;249&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;250&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;251&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;252&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;253&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;254&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;256&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;257&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;258&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;259&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;260&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;261&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;262&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;263&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;264&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;265&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;266&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;267&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;268&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;269&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;270&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;271&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;272&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;273&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;274&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;275&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;276&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;277&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;278&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;279&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;280&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;281&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;282&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;283&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;284&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;285&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;286&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;287&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;288&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;289&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;290&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;291&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;292&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;293&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;294&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;295&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;296&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;297&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;298&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;299&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;300&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;301&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;302&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;303&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Namespace&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ConfigMap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3-config&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;data:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 关于如下参数的解释，请参考文档 https://kuboard.cn/install/v3/install-built-in.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# [common]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_SERVER_NODE_PORT:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;30080&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_AGENT_SERVER_UDP_PORT:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;30081&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_AGENT_SERVER_TCP_PORT:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;30081&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_SERVER_LOGRUS_LEVEL:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;info&lt;/span&gt;  &lt;span class=&#34;comment&#34;&gt;# error / debug / trace&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_AGENT_KEY 是 Agent 与 Kuboard 通信时的密钥，请修改为一个任意的包含字母、数字的32位字符串，此密钥变更后，需要删除 Kuboard Agent 重新导入。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_AGENT_KEY:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;32b7d6572c6255211b4eec9009e4a816&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_AGENT_IMAG:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;eipwork/kuboard-agent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_QUESTDB_IMAGE:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;questdb/questdb:6.0.5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;KUBOARD_DISABLE_AUDIT:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;false&amp;#x27;&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;# 如果要禁用 Kuboard 审计功能，将此参数的值设置为 &amp;#x27;true&amp;#x27;，必须带引号。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 关于如下参数的解释，请参考文档 https://kuboard.cn/install/v3/install-gitlab.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# [gitlab login]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_LOGIN_TYPE: &amp;quot;gitlab&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_ROOT_USER: &amp;quot;your-user-name-in-gitlab&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# GITLAB_BASE_URL: &amp;quot;http://gitlab.mycompany.com&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# GITLAB_APPLICATION_ID: &amp;quot;7c10882aa46810a0402d17c66103894ac5e43d6130b81c17f7f2d8ae182040b5&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# GITLAB_CLIENT_SECRET: &amp;quot;77c149bd3a4b6870bffa1a1afaf37cba28a1817f4cf518699065f5a8fe958889&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 关于如下参数的解释，请参考文档 https://kuboard.cn/install/v3/install-github.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# [github login]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_LOGIN_TYPE: &amp;quot;github&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_ROOT_USER: &amp;quot;your-user-name-in-github&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# GITHUB_CLIENT_ID: &amp;quot;17577d45e4de7dad88e0&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# GITHUB_CLIENT_SECRET: &amp;quot;ff738553a8c7e9ad39569c8d02c1d85ec19115a7&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 关于如下参数的解释，请参考文档 https://kuboard.cn/install/v3/install-ldap.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# [ldap login]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_LOGIN_TYPE: &amp;quot;ldap&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# KUBOARD_ROOT_USER: &amp;quot;your-user-name-in-ldap&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_HOST: &amp;quot;ldap-ip-address:389&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_BIND_DN: &amp;quot;cn=admin,dc=example,dc=org&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_BIND_PASSWORD: &amp;quot;admin&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_BASE_DN: &amp;quot;dc=example,dc=org&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_FILTER: &amp;quot;(objectClass=posixAccount)&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_ID_ATTRIBUTE: &amp;quot;uid&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_USER_NAME_ATTRIBUTE: &amp;quot;uid&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_EMAIL_ATTRIBUTE: &amp;quot;mail&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_DISPLAY_NAME_ATTRIBUTE: &amp;quot;cn&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_GROUP_SEARCH_BASE_DN: &amp;quot;dc=example,dc=org&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_GROUP_SEARCH_FILTER: &amp;quot;(objectClass=posixGroup)&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_USER_MACHER_USER_ATTRIBUTE: &amp;quot;gidNumber&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_USER_MACHER_GROUP_ATTRIBUTE: &amp;quot;gidNumber&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# LDAP_GROUP_NAME_ATTRIBUTE: &amp;quot;cn&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ServiceAccount&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ClusterRoleBinding&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap-crb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;roleRef:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;apiGroup:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ClusterRole&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-admin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;subjects:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ServiceAccount&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;DaemonSet&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;revisionHistoryLimit:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;affinity:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;nodeAffinity:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;requiredDuringSchedulingIgnoredDuringExecution:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;nodeSelectorTerms:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;matchExpressions:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/master&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;matchExpressions:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/control-plane&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;matchExpressions:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;k8s.kuboard.cn/role&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;In&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;attr&#34;&gt;values:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HOSTNAME&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;valueFrom:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;fieldRef:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;fieldPath:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;spec.nodeName&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HOSTIP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;valueFrom:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;fieldRef:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;fieldPath:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;status.hostIP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;eipwork/etcd-host:3.4.16-2&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Always&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2381&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;hostPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2381&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2382&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;hostPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2382&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;peer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;livenessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;failureThreshold:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/health&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2381&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;scheme:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HTTP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;successThreshold:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;timeoutSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;volumeMounts:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;mountPath:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;dnsPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ClusterFirst&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;hostNetwork:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;restartPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Always&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;serviceAccount:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;serviceAccountName:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;tolerations:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/master&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/control-plane&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;volumes:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;hostPath:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/usr/share/kuboard/etcd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;updateStrategy:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;rollingUpdate:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;maxUnavailable:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;type:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;RollingUpdate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Deployment&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;annotations:&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;replicas:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;revisionHistoryLimit:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;affinity:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;nodeAffinity:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;preferredDuringSchedulingIgnoredDuringExecution:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;preference:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;matchExpressions:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/master&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;weight:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;preference:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;matchExpressions:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/control-plane&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;weight:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HOSTIP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;valueFrom:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;fieldRef:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;fieldPath:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;status.hostIP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HOSTNAME&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;valueFrom:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;fieldRef:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  &lt;span class=&#34;attr&#34;&gt;fieldPath:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;spec.nodeName&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;envFrom:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;configMapRef:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3-config&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;eipwork/kuboard:v3&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Always&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;livenessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;failureThreshold:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/kuboard-resources/version.json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;scheme:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HTTP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;successThreshold:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;timeoutSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;web&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;443&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;https&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;peer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;peer-u&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;UDP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;readinessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;failureThreshold:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/kuboard-resources/version.json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;attr&#34;&gt;scheme:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;HTTP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;successThreshold:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;timeoutSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;resources:&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;# startupProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#   failureThreshold: 20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#   httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#     path: /kuboard-resources/version.json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#     port: 80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#     scheme: HTTP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#   initialDelaySeconds: 5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#   periodSeconds: 10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#   successThreshold: 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;comment&#34;&gt;#   timeoutSeconds: 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;dnsPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ClusterFirst&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;restartPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Always&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;serviceAccount:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;serviceAccountName:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-boostrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;tolerations:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/master&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;operator:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Exists&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;annotations:&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;web&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;nodePort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30080&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;tcp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;nodePort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;udp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;nodePort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;UDP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10081&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;k8s.kuboard.cn/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kuboard-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;sessionAffinity:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;None&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;type:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;NodePort&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上  &lt;code&gt;yaml&lt;/code&gt;  文件可以通过  &lt;code&gt;https://github.com/fangjiaxiaobai/k8s/tree/main/yamls&lt;/code&gt;  进行获取。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://fangjiaxiaobai.github.io/2022/09/18/k8s/seris05-service/</guid>
            <title>k8s-Service</title>
            <link>https://fangjiaxiaobai.github.io/2022/09/18/k8s/seris05-service/</link>
            <category>k8s</category>
            <category>kubernetes</category>
            <pubDate>Sun, 18 Sep 2022 18:18:00 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;服务service&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#服务service&#34;&gt;#&lt;/a&gt; 服务 (Service)&lt;/h2&gt;
&lt;h3 id=&#34;解决的问题&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#解决的问题&#34;&gt;#&lt;/a&gt; 解决的问题&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Pod&lt;/code&gt;  是非永久性资源。 如果你使用  &lt;code&gt;Deployment&lt;/code&gt;  来运行你的应用程序，则它可以动态创建和销毁 Pod。&lt;/p&gt;
&lt;p&gt;每个  &lt;code&gt;Pod&lt;/code&gt;  都有自己的  &lt;code&gt;IP&lt;/code&gt;  地址，但是在  &lt;code&gt;Deployment&lt;/code&gt;  中，在同一时刻运行的  &lt;code&gt;Pod&lt;/code&gt;  集合可能与稍后运行该应用程序的  &lt;code&gt;Pod&lt;/code&gt;  集合不同。&lt;/p&gt;
&lt;p&gt;这导致了一个问题： 如果一组  &lt;code&gt;Pod&lt;/code&gt; （称为 “后端”）为集群内的其他  &lt;code&gt;Pod&lt;/code&gt; （称为 “前端”）提供功能， 那么前端如何找出并跟踪要连接的  &lt;code&gt;IP&lt;/code&gt;  地址，以便前端可以使用提供工作负载的后端部分？&lt;/p&gt;
&lt;h3 id=&#34;定义&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#定义&#34;&gt;#&lt;/a&gt; 定义&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Kubernetes Service&lt;/code&gt;  定义了这样一种抽象：一个  &lt;code&gt;Pod&lt;/code&gt;  的逻辑分组，一种可以访问它们的策略 —— 通常称为微服务。 这一组  &lt;code&gt;Pod&lt;/code&gt;  能够被  &lt;code&gt;Service&lt;/code&gt;  访问到，通常是通过  &lt;code&gt;Label Selector&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Service&lt;/code&gt;  能够提供负载均衡的能力，但是在使用上有以下限制：&lt;br&gt;
只提供  &lt;code&gt;4&lt;/code&gt;  层负载均衡能力，而没有  &lt;code&gt;7&lt;/code&gt;  层功能，但有时我们可能需要更多的匹配规则来转发请求，这点上  &lt;code&gt;4&lt;/code&gt;  层负载均衡是不支持的&lt;/p&gt;
&lt;p&gt;假设，你有一组  &lt;code&gt;pod&lt;/code&gt;  , 那如何使用一个  &lt;code&gt;Service&lt;/code&gt;  为这组  &lt;code&gt;pod&lt;/code&gt;  提供负载均衡的能力呢？刚才说了，通过  &lt;code&gt;Label Selector&lt;/code&gt;  选择出符合条件的  &lt;code&gt;Pod&lt;/code&gt; . 当请求访问到  &lt;code&gt;Service&lt;/code&gt; , 则会请求转到对应的一个  &lt;code&gt;pod&lt;/code&gt;  上。 还有一种方式就是  &lt;code&gt;非 Label Selector&lt;/code&gt;  方式.&lt;/p&gt;
&lt;h4 id=&#34;selector关联&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#selector关联&#34;&gt;#&lt;/a&gt; Selector 关联&lt;/h4&gt;
&lt;p&gt;举一个例子:&lt;/p&gt;
&lt;p&gt;假定有一组 Pod，它们对外暴露了 80 端口，同时还被打上 &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL2FwcC5rdWJlcm5ldGVzLmlvL25hbWU9cHJveHk=&#34;&gt;app.kubernetes.io/name=proxy&lt;/span&gt; 标签&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app.kubernetes.io/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;proxy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;nginx:stable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http-web-svc&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后创建了一个  &lt;code&gt;Service&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;nginx-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app.kubernetes.io/name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;proxy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;name-of-service-port&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http-web-svc&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;Kubernetes&lt;/code&gt;  为该服务分配一个  &lt;code&gt;IP&lt;/code&gt;  地址（有时称为 “集群 IP”），该  &lt;code&gt;IP&lt;/code&gt;  地址由服务代理使用。服务选择算符的控制器不断扫描与其选择算符匹配的  &lt;code&gt;Pod&lt;/code&gt;  (即  &lt;code&gt;app.kubernetes.io/name=proxy&lt;/code&gt;  的  &lt;code&gt;Pod&lt;/code&gt; ) ，然后将所有更新发布到也称为  &lt;code&gt;“my-service”&lt;/code&gt;  的  &lt;code&gt;Endpoint&lt;/code&gt;  对象。&lt;/p&gt;
&lt;p&gt;即使  &lt;code&gt;Service&lt;/code&gt;  中使用同一配置名称混合使用多个  &lt;code&gt;Pod&lt;/code&gt; ，各  &lt;code&gt;Pod&lt;/code&gt;  通过不同的端口号支持相同的网络协议， 此功能也可以使用。这为  &lt;code&gt;Service&lt;/code&gt;  的部署和演化提供了很大的灵活性。 例如，你可以在新版本中更改  &lt;code&gt;Pod&lt;/code&gt;  中后端软件公开的端口号，而不会破坏客户端。&lt;/p&gt;
&lt;h4 id=&#34;非selector关联&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#非selector关联&#34;&gt;#&lt;/a&gt; 非 Selector 关联&lt;/h4&gt;
&lt;p&gt;举个例子:&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;my-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;9376&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;创建 一个  &lt;code&gt;Service&lt;/code&gt; . 由于此服务没有选择算符，因此不会自动创建相应的  &lt;code&gt;Endpoints&lt;/code&gt;  对象。 你可以通过手动添加  &lt;code&gt;Endpoints&lt;/code&gt;  对象，将服务手动映射到运行该服务的网络地址和端口：&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Endpoints&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# 这里的 name 要与 Service 的名字相同&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;my-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;subsets:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;addresses:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;ip:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;192.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.2&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.42&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;9376&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&#34;service-可以管理多少个-endpoint&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#service-可以管理多少个-endpoint&#34;&gt;#&lt;/a&gt; Service 可以管理多少个 Endpoint&lt;/h4&gt;
&lt;p&gt;截止目前  &lt;code&gt;kubernetes v1.22&lt;/code&gt; . 一个  &lt;code&gt;Service&lt;/code&gt;  最多管理  &lt;code&gt;1000&lt;/code&gt;  个  &lt;code&gt;Pod&lt;/code&gt; .  如果某个  &lt;code&gt;Endpoints&lt;/code&gt;  资源中包含的端点个数超过  &lt;code&gt;1000&lt;/code&gt; ，则  &lt;code&gt;Kubernetes v1.22&lt;/code&gt;  版本 （及更新版本）的集群会将为该  &lt;code&gt;Endpoints&lt;/code&gt;  添加注解  &lt;code&gt;endpoints.kubernetes.io/over-capacity: truncated&lt;/code&gt; 。 这一注解表明所影响到的  &lt;code&gt;Endpoints&lt;/code&gt;  对象已经超出容量，此外  &lt;code&gt;Endpoints&lt;/code&gt;  控制器还会将  &lt;code&gt;Endpoints&lt;/code&gt;  对象数量截断到  &lt;code&gt;1000。&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;如何解决&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#如何解决&#34;&gt;#&lt;/a&gt; 如何解决&lt;/h5&gt;
&lt;p&gt;可以使用  &lt;code&gt;EndpointSlices&lt;/code&gt;  来解决.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;EndpointSlices&lt;/code&gt;  是一种  &lt;code&gt;API&lt;/code&gt;  资源，可以为  &lt;code&gt;Endpoints&lt;/code&gt;  提供更可扩展的替代方案。 尽管从概念上讲与  &lt;code&gt;Endpoints&lt;/code&gt;  非常相似，但  &lt;code&gt;EndpointSlices&lt;/code&gt;  允许跨多个资源分布网络端点。 默认情况下，一旦到达  &lt;code&gt;100&lt;/code&gt;  个  &lt;code&gt;Endpoint&lt;/code&gt; ，该  &lt;code&gt;EndpointSlice&lt;/code&gt;  将被视为 “已满”， 届时将创建其他  &lt;code&gt;EndpointSlices&lt;/code&gt;  来存储任何其他  &lt;code&gt;Endpoints&lt;/code&gt;  。&lt;/p&gt;
&lt;h3 id=&#34;service的类型&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#service的类型&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Service&lt;/code&gt;  的类型&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Service&lt;/code&gt;  在  &lt;code&gt;K8s&lt;/code&gt;  中有以下五种类型&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ClusterIp&lt;/code&gt; ：默认类型，自动分配一个仅  &lt;code&gt;Cluster&lt;/code&gt;  内部可以访问的虚拟  &lt;code&gt;IP&lt;/code&gt; ，这种类型使得 Service 只能从集群内访问。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NodePort&lt;/code&gt; ：在  &lt;code&gt;ClusterIP&lt;/code&gt;  基础上为  &lt;code&gt;Service&lt;/code&gt;  在每台机器上绑定一个端口，这样就可以通过 :  &lt;code&gt;NodePort&lt;/code&gt;  来访问该服务&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LoadBalancer&lt;/code&gt; ：在  &lt;code&gt;NodePort&lt;/code&gt;  的基础上，借助  &lt;code&gt;cloud provider&lt;/code&gt;  创建一个外部负载均衡器，并将请求转发到:  &lt;code&gt;NodePort&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ExternalName&lt;/code&gt; ：把集群外部的服务引入到集群内部来，在集群内部直接使用。没有任何类型代理被创建，这只有  &lt;code&gt;kubernetes 1.7&lt;/code&gt;  或更高版本的  &lt;code&gt;kube-dns&lt;/code&gt;  才支持&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ingress&lt;/code&gt; :  &lt;code&gt;Ingress&lt;/code&gt;  是对集群中服务的外部访问进行管理的  &lt;code&gt;API&lt;/code&gt;  对象，典型的访问方式是  &lt;code&gt;HTTP&lt;/code&gt; 。 &lt;code&gt;Ingress&lt;/code&gt;  可以提供负载均衡、  &lt;code&gt;SSL&lt;/code&gt;  终结和基于名称的虚拟托管。 &lt;code&gt;Ingress&lt;/code&gt;  公开从集群外部到集群内服务的  &lt;code&gt;HTTP&lt;/code&gt;  和  &lt;code&gt;HTTPS&lt;/code&gt;  路由。 流量路由由  &lt;code&gt;Ingress&lt;/code&gt;  资源上定义的规则控制。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;代理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#代理&#34;&gt;#&lt;/a&gt; 代理&lt;/h2&gt;
&lt;h3 id=&#34;vip-和-service代理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#vip-和-service代理&#34;&gt;#&lt;/a&gt;  &lt;code&gt;VIP&lt;/code&gt;  和  &lt;code&gt;Service&lt;/code&gt;  代理&lt;/h3&gt;
&lt;p&gt;在  &lt;code&gt;Kubernetes&lt;/code&gt;  集群中，每个  &lt;code&gt;Node&lt;/code&gt;  运行一个  &lt;code&gt;kube-proxy&lt;/code&gt;  进程。  &lt;code&gt;kube-proxy&lt;/code&gt;  负责为  &lt;code&gt;Service&lt;/code&gt;  实现了一种  &lt;code&gt;VIP(虚拟IP)&lt;/code&gt;  的形式，而不是  &lt;code&gt;ExternalName&lt;/code&gt;  的形式。 在  &lt;code&gt;Kubernetes v1.0&lt;/code&gt;  版本，代理完全在  &lt;code&gt;userspace&lt;/code&gt; 。在  &lt;code&gt;Kubernetes v1.1&lt;/code&gt;  版本，新增了  &lt;code&gt;iptables&lt;/code&gt;  代理，但并不是默认的运行模式。 从  &lt;code&gt;Kubernetes v1.2&lt;/code&gt;  起，默认就是 &lt;code&gt;iptables&lt;/code&gt;  代理。 在  &lt;code&gt;Kubernetes v1.8.0-beta.0&lt;/code&gt;  中，添加了 ipvs 代理在  &lt;code&gt;Kubernetes 1.14&lt;/code&gt;  版本开始默认使用  &lt;code&gt;ipvs&lt;/code&gt;  代理。在  &lt;code&gt;Kubernetes v1.0&lt;/code&gt;  版本，  &lt;code&gt;Service&lt;/code&gt;  是  &lt;code&gt;“4层”&lt;/code&gt; （ &lt;code&gt;TCP/UDP over IP&lt;/code&gt; ）概念。 在  &lt;code&gt;Kubernetes v1.1&lt;/code&gt;  版本，新增了  &lt;code&gt;Ingress API(beta 版)&lt;/code&gt; ，用来表示  &lt;code&gt;“7层”(HTTP)&lt;/code&gt;  服务&lt;/p&gt;
&lt;h3 id=&#34;代理模式的分类&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#代理模式的分类&#34;&gt;#&lt;/a&gt; 代理模式的分类&lt;/h3&gt;
&lt;h4 id=&#34;userspace&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#userspace&#34;&gt;#&lt;/a&gt;  &lt;code&gt;userspace&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;kube-proxy&lt;/code&gt;  会监视  &lt;code&gt;Kubernetes kubelet&lt;/code&gt;  对  &lt;code&gt;Service&lt;/code&gt;  对象和  &lt;code&gt;Endpoints&lt;/code&gt;  对象的添加和移除操作。 对每个  &lt;code&gt;Service&lt;/code&gt; ，它会在本地  &lt;code&gt;Node&lt;/code&gt;  上打开一个端口（随机选择）。 任何连接到 “代理端口” 的请求，都会被代理到  &lt;code&gt;Service&lt;/code&gt;  的某个  &lt;code&gt;pod&lt;/code&gt;  上。使用哪个后端  &lt;code&gt;Pod&lt;/code&gt;  ，是  &lt;code&gt;kube-proxy&lt;/code&gt;  基于  &lt;code&gt;SessionAffinity&lt;/code&gt;  来确定的。&lt;/p&gt;
&lt;p&gt;最后，它配置  &lt;code&gt;iptables&lt;/code&gt;  规则，捕获到达该  &lt;code&gt;Service&lt;/code&gt;  的  &lt;code&gt;clusterIP&lt;/code&gt; （是虚拟 IP） 和  &lt;code&gt;Port&lt;/code&gt;  的请求，并重定向到代理端口，代理端口再代理请求到后端 &lt;code&gt;Pod&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;默认情况下，用户空间模式下的  &lt;code&gt;kube-proxy&lt;/code&gt;  通过轮转算法选择后端。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-01.svg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;iptables&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#iptables&#34;&gt;#&lt;/a&gt; iptables&lt;/h4&gt;
&lt;p&gt;这种模式， &lt;code&gt;kube-proxy&lt;/code&gt;  会监视  &lt;code&gt;Kubernetes&lt;/code&gt;  控制节点对  &lt;code&gt;Service&lt;/code&gt;  对象和  &lt;code&gt;Endpoints&lt;/code&gt;  对象的添加和移除。 对每个  &lt;code&gt;Service&lt;/code&gt; ，它会配置  &lt;code&gt;iptables&lt;/code&gt;  规则，从而捕获到达该  &lt;code&gt;Service&lt;/code&gt;  的  &lt;code&gt;clusterIP&lt;/code&gt;  和端口的请求，进而将请求重定向到  &lt;code&gt;Service&lt;/code&gt;  的一组后端中的某个  &lt;code&gt;Pod&lt;/code&gt;  上面。 对于每个  &lt;code&gt;Endpoints&lt;/code&gt;  对象，它也会配置  &lt;code&gt;iptables&lt;/code&gt;  规则，这个规则会选择一个后端组合。&lt;/p&gt;
&lt;p&gt;默认的策略是， &lt;code&gt;kube-proxy&lt;/code&gt;  在  &lt;code&gt;iptables&lt;/code&gt;  模式下随机选择一个后端。&lt;/p&gt;
&lt;p&gt;使用  &lt;code&gt;iptables&lt;/code&gt;  处理流量具有较低的系统开销，因为流量由  &lt;code&gt;Linux netfilter&lt;/code&gt;  处理， 而无需在用户空间和内核空间之间切换。 这种方法也可能更可靠。&lt;/p&gt;
&lt;p&gt;如果  &lt;code&gt;kube-proxy&lt;/code&gt;  在  &lt;code&gt;iptables&lt;/code&gt;  模式下运行，并且所选的第一个  &lt;code&gt;Pod&lt;/code&gt;  没有响应，则连接失败。 这与用户空间模式不同：在这种情况下， &lt;code&gt;kube-proxy&lt;/code&gt;  将检测到与第一个  &lt;code&gt;Pod&lt;/code&gt;  的连接已失败， 并会自动使用其他后端  &lt;code&gt;Pod&lt;/code&gt;  重试。&lt;/p&gt;
&lt;p&gt;你可以使用  &lt;code&gt;Pod&lt;/code&gt;  就绪探测器 验证后端  &lt;code&gt;Pod&lt;/code&gt;  可以正常工作，以便  &lt;code&gt;iptables&lt;/code&gt;  模式下的  &lt;code&gt;kube-proxy&lt;/code&gt;  仅看到测试正常的后端。 这样做意味着你避免将流量通过  &lt;code&gt;kube-proxy&lt;/code&gt;  发送到已知已失败的  &lt;code&gt;Pod&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-02.svg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;ipvs&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ipvs&#34;&gt;#&lt;/a&gt; ipvs&lt;/h4&gt;
&lt;p&gt;这种模式， &lt;code&gt;kube-proxy&lt;/code&gt;  会监视  &lt;code&gt;Kubernetes Service&lt;/code&gt;  对象和  &lt;code&gt;Endpoints&lt;/code&gt;  ，调用  &lt;code&gt;netlink&lt;/code&gt;  接口以相应地创建 &lt;code&gt;ipvs&lt;/code&gt;  规则并定期与  &lt;code&gt;Kubernetes Service&lt;/code&gt;  对象和  &lt;code&gt;Endpoints&lt;/code&gt;  对象同步  &lt;code&gt;ipvs&lt;/code&gt;  规则，以确保  &lt;code&gt;ipvs&lt;/code&gt;  状态与期望一致。访问服务时，流量将被重定向到其中一个后端  &lt;code&gt;Pod&lt;/code&gt; . 与  &lt;code&gt;iptables&lt;/code&gt;  类似， &lt;code&gt;ipvs&lt;/code&gt;  于  &lt;code&gt;netﬁlter&lt;/code&gt;  的  &lt;code&gt;hook&lt;/code&gt;  功能，但使用哈希表作为底层数据结构并在内核空间中工作。这意味着  &lt;code&gt;ipvs&lt;/code&gt;  可以更快地重定向流量，并且在同步代理规则时具有更好的性能。此外， &lt;code&gt;ipvs&lt;/code&gt;  为负载均衡算法提供了更多选项，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rr&lt;/code&gt; ：轮询调度&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lc&lt;/code&gt;  ：最小连接数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dh&lt;/code&gt;  ：目标哈希&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sh&lt;/code&gt;  ：源哈希&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sed&lt;/code&gt;  ：最短期望延迟&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nq&lt;/code&gt;  ： 不排队调度&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-03.svg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;service-类型实验&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#service-类型实验&#34;&gt;#&lt;/a&gt; Service 类型实验&lt;/h2&gt;
&lt;h3 id=&#34;clusterip&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#clusterip&#34;&gt;#&lt;/a&gt;  &lt;code&gt;ClusterIP&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;clusterIP&lt;/code&gt;  主要在每个  &lt;code&gt;node&lt;/code&gt;  节点使用  &lt;code&gt;iptables&lt;/code&gt;  等代理方式，将发向  &lt;code&gt;clusterIP&lt;/code&gt;  对应端口的数据，转发到  &lt;code&gt;kube-proxy&lt;/code&gt;  中。然后  &lt;code&gt;kube-proxy&lt;/code&gt;  自己内部实现有负载均衡的方法，并可以查询到这个  &lt;code&gt;service&lt;/code&gt;  下对应  &lt;code&gt;pod&lt;/code&gt;  的地址和端口，进而把数据转发给对应的  &lt;code&gt;pod&lt;/code&gt;  的地址和端口。 这种类型使得 Service 只能从集群内访问。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-04.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;为了实现图上的功能，主要需要以下几个组件的协同工作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;apiserver&lt;/code&gt;  用户通过 &lt;code&gt;kubectl&lt;/code&gt;  命令向 &lt;code&gt;apiserver&lt;/code&gt;  发送创建 &lt;code&gt;service&lt;/code&gt;  的命令， &lt;code&gt;apiserver&lt;/code&gt;  接收到请求后将数据存储到 &lt;code&gt;etcd&lt;/code&gt;  中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kube-proxy kubernetes&lt;/code&gt;  的每个节点中都有一个叫做 &lt;code&gt;kube-porxy&lt;/code&gt;  的进程，这个进程负责感知 &lt;code&gt;service&lt;/code&gt; ， &lt;code&gt;pod&lt;/code&gt;  的变化，并将变化的信息写入本地的 &lt;code&gt;iptables&lt;/code&gt;  规则中.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;iptables&lt;/code&gt;  使用 &lt;code&gt;NAT&lt;/code&gt;  等技术将 &lt;code&gt;virtualIP&lt;/code&gt;  的流量转至 &lt;code&gt;endpoint&lt;/code&gt;  中&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;创建一个deploy&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建一个deploy&#34;&gt;#&lt;/a&gt; 创建一个 deploy&lt;/h4&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Deployment&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;replicas:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;tag:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;tag:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;test&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IfNotPresent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;MY_APP_VERSION&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;value:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;3.0&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-06.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;把-deploymenet-绑定到-service-上&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#把-deploymenet-绑定到-service-上&#34;&gt;#&lt;/a&gt; 把  &lt;code&gt;Deploymenet&lt;/code&gt;  绑定到  &lt;code&gt;Service&lt;/code&gt;  上&lt;/h4&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;service-cluster-ip-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;type:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ClusterIP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;tag:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-07.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;headless-service&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#headless-service&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Headless Service&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;有时不需要或不想要负载均衡 sc 以及单独的  &lt;code&gt;Service IP&lt;/code&gt;  。遇到这种情况，可以通过指定  &lt;code&gt;Cluster IP(spec.clusterIP)&lt;/code&gt;  的值为  &lt;code&gt;“None”&lt;/code&gt;  来创建  &lt;code&gt;Headless Service&lt;/code&gt;  。这类  &lt;code&gt;Service&lt;/code&gt;  并不会分配  &lt;code&gt;Cluster IP&lt;/code&gt; ，  &lt;code&gt;kube-proxy&lt;/code&gt;  不会处理它们，而且平台也不会为它们进行负载均衡和路由&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;headless-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;headless-app&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;clusterIp:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;None&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用 &lt;code&gt;dig&lt;/code&gt;  命令可以验证一下&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;dig -t A headless-service.default.svc.cluster.local. @10.96.0.10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;nodeport&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#nodeport&#34;&gt;#&lt;/a&gt;  &lt;code&gt;NodePort&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;nodePort&lt;/code&gt;  的原理在于在  &lt;code&gt;node&lt;/code&gt;  上开了一个端口，将向该端口的流量导入到  &lt;code&gt;kube-proxy&lt;/code&gt; ，然后由  &lt;code&gt;kube-proxy&lt;/code&gt;  进一步到给对应的  &lt;code&gt;pod&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;创建-deployment&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建-deployment&#34;&gt;#&lt;/a&gt; 创建  &lt;code&gt;Deployment&lt;/code&gt;&lt;/h4&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Deployment&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-container-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;replicas:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;tag:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-tag-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;tag:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-tag-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;test&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cluster-ip-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IfNotPresent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;MY_APP_VERSION&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;value:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;3.0&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&#34;绑定到-service-上&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#绑定到-service-上&#34;&gt;#&lt;/a&gt; 绑定到  &lt;code&gt;Service&lt;/code&gt;  上。&lt;/h4&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;type:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;NodePort&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;tag:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-port-tag-v3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;test&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-08.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以在浏览器上访问  &lt;code&gt;Node&lt;/code&gt;  的  &lt;code&gt;IP&lt;/code&gt; ( &lt;code&gt;http://192.168.0.10:31024/&lt;/code&gt; ), 多次访问查看  &lt;code&gt;hostname&lt;/code&gt;  和  &lt;code&gt;ip&lt;/code&gt;  的变化.&lt;/p&gt;
&lt;h3 id=&#34;loadbalancer&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#loadbalancer&#34;&gt;#&lt;/a&gt;  &lt;code&gt;LoadBalancer&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;loadBalancer&lt;/code&gt;  和  &lt;code&gt;nodePort&lt;/code&gt;  其实是同一种方式。区别在于  &lt;code&gt;loadBalancer&lt;/code&gt;  比  &lt;code&gt;nodePort&lt;/code&gt;  多了一步，就是可以调用  &lt;code&gt;cloud provider&lt;/code&gt;  去创建  &lt;code&gt;LB&lt;/code&gt;  来向节点导流.&lt;/p&gt;
&lt;h3 id=&#34;externalname&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#externalname&#34;&gt;#&lt;/a&gt;  &lt;code&gt;ExternalName&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;这种类型的  &lt;code&gt;Service&lt;/code&gt;  通过返回  &lt;code&gt;CNAME&lt;/code&gt;  和它的值，可以将服务映射到  &lt;code&gt;externalName&lt;/code&gt;  字段的内容 ( 例如：&lt;br&gt;
 &lt;code&gt;hub.atguigu.com&lt;/code&gt;  )。  &lt;code&gt;ExternalName Service&lt;/code&gt;  是  &lt;code&gt;Service&lt;/code&gt;  的特例，它没有  &lt;code&gt;selector&lt;/code&gt;  ，也没有定义任何的端口和  &lt;code&gt;Endpoint&lt;/code&gt;  。相反的，对于运行在集群外部的服务，它通过返回该外部服务的别名这种方式来提供服务&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;external-name-service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;type:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ExternalName&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;externalName:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;www.fangjiaxiaobai.cn&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/05-09.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;当查询主机  &lt;code&gt;my-service.defalut.svc.cluster.local&lt;/code&gt;  (  &lt;code&gt;SVC_NAME.NAMESPACE.svc.cluster.local&lt;/code&gt;  ) 时，集群的  &lt;code&gt;DNS&lt;/code&gt;  服务将返回一个值  &lt;code&gt;my.database.example.com&lt;/code&gt;  的  &lt;code&gt;CNAME&lt;/code&gt;  记录。访问这个服务的工作方式和其他的相同，唯一不同的是重定向发生在  &lt;code&gt;DNS&lt;/code&gt;  层，而且不会进行代理或转发&lt;/p&gt;
&lt;p&gt;下一篇，我们介绍另外一种 资源控制器  &lt;code&gt;Ingress&lt;/code&gt; .&lt;/p&gt;
&lt;h2 id=&#34;最后&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#最后&#34;&gt;#&lt;/a&gt; 最后&lt;/h2&gt;
&lt;p&gt;希望和你一起遇见更好的自己&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/qrcode.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://fangjiaxiaobai.github.io/2022/08/07/k8s/seris04-work-load/</guid>
            <title>k8s-资源控制器</title>
            <link>https://fangjiaxiaobai.github.io/2022/08/07/k8s/seris04-work-load/</link>
            <category>k8s</category>
            <category>kubernetes</category>
            <pubDate>Sun, 07 Aug 2022 18:18:00 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;pod&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#pod&#34;&gt;#&lt;/a&gt; Pod&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Pod&lt;/code&gt;  是可以在  &lt;code&gt;Kubernetes&lt;/code&gt;  中创建和管理的、最小的可部署的计算单元。  &lt;code&gt;Pod&lt;/code&gt;  是一组容器，一个  &lt;code&gt;pod&lt;/code&gt;  的所有容器共享  &lt;code&gt;pod&lt;/code&gt;  的网路，存储 以及运行容器的声明。&lt;/p&gt;
&lt;p&gt;通常用户需要直接创建  &lt;code&gt;Pod&lt;/code&gt;  , 而是使用负载资源来替用户管理一组  &lt;code&gt;Pod&lt;/code&gt;  . 这些负载资源通过配置 &lt;strong&gt;控制器&lt;/strong&gt; 来确保正确类型的、处于运行状态的  &lt;code&gt;Pod&lt;/code&gt;  个数是正确的，与用户所指定的状态相一致。&lt;/p&gt;
&lt;h2 id=&#34;控制器&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#控制器&#34;&gt;#&lt;/a&gt; 控制器&lt;/h2&gt;
&lt;h3 id=&#34;replication-controller-和-replicaset&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#replication-controller-和-replicaset&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Replication Controller&lt;/code&gt;  和  &lt;code&gt;ReplicaSet&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ReplicationController(RC)&lt;/code&gt;  用来确保容器应用的副本数始终保持在用户定义的副本数，即如果有容器异常退&lt;br&gt;
出，会自动创建新的  &lt;code&gt;Pod&lt;/code&gt;  来替代；而如果异常多出来的容器也会自动回收；&lt;br&gt;
 在新版本的  &lt;code&gt;Kubernetes&lt;/code&gt;  中建议使用  &lt;code&gt;ReplicaSet&lt;/code&gt;  来取代  &lt;code&gt;ReplicationController&lt;/code&gt;  。  &lt;code&gt;ReplicaSet&lt;/code&gt;  跟&lt;br&gt;
 &lt;code&gt;ReplicationController&lt;/code&gt;  没有本质的不同，只是名字不一样，并且  &lt;code&gt;ReplicaSet&lt;/code&gt;  支持集合式的  &lt;code&gt;selector&lt;/code&gt; .&lt;/p&gt;
&lt;h4 id=&#34;实验&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验&#34;&gt;#&lt;/a&gt; 实验&lt;/h4&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ReplicaSet&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;replica-set-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;replicas:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;rs_label:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rs-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;rs_label:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rs-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;replica-set-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;env:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;JAVA_VERSION&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;value:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;11&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;查看 当前的 &lt;code&gt;pod&lt;/code&gt; &lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-01.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;新开一个窗口，使用命令:  &lt;code&gt;kubectl get pod -o wide -w&lt;/code&gt;  来查看 pod 的变化过程.&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-02.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;然后使用命令  &lt;code&gt;kubectl delete pod replica-set-demo-2wlcm&lt;/code&gt;  删除其中的任意一个  &lt;code&gt;pod&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;然后 可以看到新窗口中出现了如下的变化:&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-04.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
 删除的 &lt;code&gt;pod&lt;/code&gt; ( &lt;code&gt;2wlcm&lt;/code&gt; ) 先从  &lt;code&gt;Running&lt;/code&gt;  变成了  &lt;code&gt;Terminating&lt;/code&gt; , 然后启动了一个新的  &lt;code&gt;pod (z48pp)&lt;/code&gt; , 状态从  &lt;code&gt;Pending&lt;/code&gt;  -&amp;gt;  &lt;code&gt;ContainerCreating&lt;/code&gt; -&amp;gt; &lt;code&gt;Running&lt;/code&gt; .&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;修改标签&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#修改标签&#34;&gt;#&lt;/a&gt; 修改标签&lt;/h5&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-05.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过命令  &lt;code&gt;kubectl get pod --show-labels&lt;/code&gt;  查看  &lt;code&gt;pod&lt;/code&gt;  的标签。&lt;/li&gt;
&lt;li&gt;通过命令  &lt;code&gt;kubectl label pod replica-set-demo-z48pp rs_label=rs-edit-label-exp --overwrite=True&lt;/code&gt;  修改  &lt;code&gt;pod&lt;/code&gt;  的标签。&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;发现 新启动了一个  &lt;code&gt;pod&lt;/code&gt; , 如上图中的  &lt;code&gt;(Pod)nbxnf&lt;/code&gt; 。此时 原来的 pod 就变成了新的标签。&lt;/p&gt;
&lt;p&gt;由此可以看出:  &lt;code&gt;ReplicaSet&lt;/code&gt;  是通过  &lt;code&gt;labels&lt;/code&gt;  来判断 &lt;code&gt;pod&lt;/code&gt;  是否属于当前的  &lt;code&gt;RS&lt;/code&gt;  的。&lt;/p&gt;
&lt;p&gt;那 新建一个相同标签的 &lt;code&gt;pod&lt;/code&gt;  会发生什么呢？&lt;/p&gt;
&lt;h5 id=&#34;修改回原来的标签&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#修改回原来的标签&#34;&gt;#&lt;/a&gt; 修改回原来的标签&lt;/h5&gt;
&lt;p&gt;我先把 标签修改成原来的  &lt;code&gt;kubectl label pod replica-set-demo-z48pp rs_label=rs-demo --overwrite=True&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-06.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;k8s&lt;/code&gt;  删掉了最新创建的那个容器。&lt;/p&gt;
&lt;h5 id=&#34;新建一个相同标签的pod容器&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#新建一个相同标签的pod容器&#34;&gt;#&lt;/a&gt; 新建一个相同标签的 &lt;code&gt;pod&lt;/code&gt;  容器&lt;/h5&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rs-demo-add-sample-label-ex&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;rs_label:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rs-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rs-demo-add-sample-label-ex-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;创建这个容器之后，会发现&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-07.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;这个容器在创建时机就会被 &lt;code&gt;kill&lt;/code&gt;  掉。&lt;/p&gt;
&lt;h5 id=&#34;删除-replicaset&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#删除-replicaset&#34;&gt;#&lt;/a&gt; 删除 ReplicaSet&lt;/h5&gt;
&lt;p&gt;使用命令  &lt;code&gt;kubectl delete rs replica-set-demo&lt;/code&gt;  删除即可.&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-08.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;deployment&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#deployment&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Deployment&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-11.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Deployment&lt;/code&gt;  为  &lt;code&gt;Pod&lt;/code&gt;  和  &lt;code&gt;ReplicaSet&lt;/code&gt;  提供了一个声明式定义 ( &lt;code&gt;declarative&lt;/code&gt; ) 方法，用来替代以前的  &lt;code&gt;ReplicationController&lt;/code&gt;  来方便的管理应用。典型的应用场景包括；&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;定义  &lt;code&gt;Deployment&lt;/code&gt;  来创建  &lt;code&gt;Pod&lt;/code&gt;  和  &lt;code&gt;ReplicaSet&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;滚动升级和回滚应用&lt;/li&gt;
&lt;li&gt;扩容和缩容&lt;/li&gt;
&lt;li&gt;暂停和继续  &lt;code&gt;Deployment&lt;/code&gt; .&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;升级策略&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#升级策略&#34;&gt;#&lt;/a&gt; 升级策略&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Deployment&lt;/code&gt;  可以保证在升级时只有一定数量的  &lt;code&gt;Pod&lt;/code&gt;  是  &lt;code&gt;down&lt;/code&gt;  的。默认的，它会确保至少有比期望的 Pod 数量少一个是 &lt;code&gt;up&lt;/code&gt;  状态 (最多一个不可用)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Deployment&lt;/code&gt;  同时也可以确保只创建出超过期望数量的一定数量的  &lt;code&gt;Pod&lt;/code&gt; 。默认的，它会确保最多比期望的 &lt;code&gt;Pod&lt;/code&gt;  数&lt;br&gt;
量多一个的  &lt;code&gt;Pod&lt;/code&gt;  是  &lt;code&gt;up&lt;/code&gt;  的 (最多 &lt;code&gt;1&lt;/code&gt;  个  &lt;code&gt;surge&lt;/code&gt;  )&lt;/p&gt;
&lt;p&gt;未来的  &lt;code&gt;Kuberentes&lt;/code&gt;  版本中，将从 &lt;code&gt;1-1&lt;/code&gt;  变成 &lt;code&gt;25%-25%&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;实验-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验-2&#34;&gt;#&lt;/a&gt; 实验&lt;/h4&gt;
&lt;h5 id=&#34;创建deployment&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建deployment&#34;&gt;#&lt;/a&gt; 创建 &lt;code&gt;Deployment&lt;/code&gt;&lt;/h5&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Deployment&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;deployment-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;replicas:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;demo_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;deployment-labels&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;demo_name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;deployment-labels&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;deployment-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;使用命令  &lt;code&gt;kubectl get pod -w&lt;/code&gt;  监听 Pod 的变化&lt;/li&gt;
&lt;li&gt;使用命令  &lt;code&gt;kubectl apply -f 07-deployment-demo.yaml&lt;/code&gt;  创建  &lt;code&gt;deployment&lt;/code&gt; &lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-09.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;查看对应 &lt;code&gt;Pod&lt;/code&gt;  的变化。&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-10.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;扩缩容&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#扩缩容&#34;&gt;#&lt;/a&gt; 扩缩容&lt;/h5&gt;
&lt;p&gt;下面我们先演示一个比较简单的案例，扩缩容。&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl scale deployment deployment-demo --replicas=4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-12.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果集群支持自动扩容的话，还可以为集群设置  &lt;code&gt;autoscaling&lt;/code&gt; .&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl autoscale deployment xxx --min=10 --max=15 --cpu-percent=80&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;设置镜像&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#设置镜像&#34;&gt;#&lt;/a&gt; 设置镜像&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl set image xxxx imagesName:v1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;具体如何操作接着往下看。&lt;/p&gt;
&lt;h5 id=&#34;滚动升级&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#滚动升级&#34;&gt;#&lt;/a&gt; 滚动升级&lt;/h5&gt;
&lt;p&gt;在真是的业务场景中，大部分都是通过设置升级镜像的版本来触发  &lt;code&gt;deployment&lt;/code&gt;  的升级.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用命令  &lt;code&gt;kubectl set image deployment/deployment-demo deployment-demo-container=fangjiaxiaobai/my-app:v2&lt;/code&gt;  修改  &lt;code&gt;deployment&lt;/code&gt;  的版本。&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-14.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;Deployment&lt;/code&gt;  的变化过程&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-13.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
可以看到  &lt;code&gt;k8s&lt;/code&gt;  先启动一个 &lt;code&gt;pod&lt;/code&gt; , 然后 &lt;code&gt;kill&lt;/code&gt;  一个 &lt;code&gt;pod&lt;/code&gt; . 最终完成整个  &lt;code&gt;Deployment&lt;/code&gt;  的更新。&lt;/li&gt;
&lt;li&gt;然后，我们访问一下页面，看一个应用的版本&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/04-15.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;回滚-rollover&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#回滚-rollover&#34;&gt;#&lt;/a&gt; 回滚 rollover&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;使用命令  &lt;code&gt;kubectl rollout undo deployment/deployment-demo&lt;/code&gt;  将  &lt;code&gt;Deployment&lt;/code&gt;  回滚到上一次的版本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-16.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到已经回滚到了  &lt;code&gt;V1&lt;/code&gt;  版本。&lt;/p&gt;
&lt;h5 id=&#34;清理策略&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#清理策略&#34;&gt;#&lt;/a&gt; 清理策略&lt;/h5&gt;
&lt;p&gt;可以通过设置  &lt;code&gt;.spec.revisonHistoryLimit&lt;/code&gt;  来指定  &lt;code&gt;deploymenet&lt;/code&gt;  最多保留  &lt;code&gt;revison&lt;/code&gt;  历史版本。默认会保留所有历史版本，如果设置为 &lt;code&gt;0&lt;/code&gt; , 则  &lt;code&gt;Deployment&lt;/code&gt;  就不允许回滚了。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;命令式编程 和 命令式编程&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;命令式编程：它侧重于 如何实现程序，就像我们刚接触编程的时候那样，我们需要把程序的实现过程按照逻辑一步步写下来。面向过程编程。&lt;/li&gt;
&lt;li&gt;声明式编程：它侧重于定义想要什么，然后告诉计算机 / 引擎，让他帮你去实现。 面向对象编程.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;daemonset&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#daemonset&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Daemonset&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;DaemonSet&lt;/code&gt;  确保全部 (或者一些) &lt;code&gt;Node&lt;/code&gt;  上运行一个  &lt;code&gt;Pod&lt;/code&gt;  的副本。当有  &lt;code&gt;Node&lt;/code&gt;  加入集群时，也会为他们新增一个  &lt;code&gt;Pod&lt;/code&gt;  。当有  &lt;code&gt;Node&lt;/code&gt;  从集群移除时，这些  &lt;code&gt;Pod&lt;/code&gt;  也会被回收。删除  &lt;code&gt;DaemonSet&lt;/code&gt;  将会删除它创建的所有  &lt;code&gt;Pod&lt;/code&gt; . 使用  &lt;code&gt;DaemonSet&lt;/code&gt;  的一些典型用法:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;运行集群存储  &lt;code&gt;daemon&lt;/code&gt;  ，例如在每个  &lt;code&gt;Node&lt;/code&gt;  上运行  &lt;code&gt;glusterd&lt;/code&gt;  、  &lt;code&gt;ceph&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在每个  &lt;code&gt;Node&lt;/code&gt;  上运行日志收集  &lt;code&gt;daemon&lt;/code&gt;  ，例如  &lt;code&gt;fluentd&lt;/code&gt;  、  &lt;code&gt;logstash&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在每个  &lt;code&gt;Node&lt;/code&gt;  上运行监控  &lt;code&gt;daemon&lt;/code&gt;  ，例如 &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3Byb21ldGhldXMvbm9kZV9leHBvcnRlcg==&#34;&gt;Prometheus Node Exporter&lt;/span&gt;、  &lt;code&gt;collectd&lt;/code&gt;   &lt;code&gt;、Datadog&lt;/code&gt;  代理、  &lt;code&gt;New Relic&lt;/code&gt;  代理，或 &lt;code&gt; Ganglia gmond&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;apps/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;DaemonSet&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;daemon-set-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;daemon-set&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;selector:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;matchLabels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;daemon-set&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;daemon-set&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;daemon-set-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-17.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;job&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#job&#34;&gt;#&lt;/a&gt; Job&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Job&lt;/code&gt;  负责批处理任务，即仅执行一次的任务，它保证批处理任务的一个或多个  &lt;code&gt;Pod&lt;/code&gt;  成功结束&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特殊说明
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;spec.template&lt;/code&gt; : 格式同  &lt;code&gt;pod&lt;/code&gt; .&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RestartPolicy&lt;/code&gt; : 仅支持  &lt;code&gt;Never&lt;/code&gt;  或者  &lt;code&gt;OnFailure&lt;/code&gt; .&lt;/li&gt;
&lt;li&gt;单个  &lt;code&gt;Pod&lt;/code&gt;  时 默认  &lt;code&gt;Pod&lt;/code&gt;  成功运行后  &lt;code&gt;Job&lt;/code&gt;  即结束。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.spec.completios&lt;/code&gt; : 标志 Job 结束时需要成功运行的 &lt;code&gt;Pod&lt;/code&gt;  个数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.spec.parallelism&lt;/code&gt; : 标识 并行运行的 &lt;code&gt;pod&lt;/code&gt;  的个数，默认为 1&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.spec.activeDeadlineSeconds&lt;/code&gt; : 标识失败 &lt;code&gt;Pod&lt;/code&gt;  重试的最后间隔时间，超过这个时间将不会再重试&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;实验-3&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验-3&#34;&gt;#&lt;/a&gt; 实验&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;创建一个 Job&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;batch/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Job&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;job-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;job-demo-template&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;job-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;perl:5.34.0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;quot;perl&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;-Mbignum=bpi&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;-wle&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;print bpi(2000)&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;restartPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Never&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-18.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;cron-job&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#cron-job&#34;&gt;#&lt;/a&gt; Cron Job&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Cron Job&lt;/code&gt;  管理基于时间的  &lt;code&gt;Job&lt;/code&gt; ，即:&lt;br&gt;
 在给定时间点只运行一次&lt;br&gt;
周期性地在给定时间点运行&lt;br&gt;
使用前提条件:&lt;strong&gt; 当前使用的 Kubernetes 集群，版本 &amp;gt;= 1.8 (对 CronJob)。对于先前版本的集群，版本 &amp;lt; 1.8，启动 API Server 时，通过传递选项 --runtime-config=batch/v2alpha1=true 可以开启 batch/v2alpha1 API&lt;/strong&gt;&lt;br&gt;
 典型的用法如下所示:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在给定的时间点调度  &lt;code&gt;Job&lt;/code&gt;  运行&lt;/li&gt;
&lt;li&gt;创建周期性运行的  &lt;code&gt;Job&lt;/code&gt; ，例如：数据库备份、发送邮件&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;特殊说明&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#特殊说明&#34;&gt;#&lt;/a&gt; 特殊说明&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;spec.schedule&lt;/code&gt;  ：调度，必需字段，指定任务运行周期，格式同  &lt;code&gt;Cron&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spec.jobTemplate&lt;/code&gt;  ：  &lt;code&gt;Job&lt;/code&gt;  模板，必需字段，指定需要运行的任务，格式同  &lt;code&gt;Job&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spec.startingDeadlineSeconds&lt;/code&gt;  ：启动  &lt;code&gt;Job&lt;/code&gt;  的期限（秒级别），该字段是可选的。如果因为任何原因而错&lt;br&gt;
过了被调度的时间，那么错过执行时间的  &lt;code&gt;Job&lt;/code&gt;  将被认为是失败的。如果没有指定，则没有期限&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spec.concurrencyPolicy&lt;/code&gt;  ：并发策略，该字段也是可选的。它指定了如何处理被  &lt;code&gt;Cron Job&lt;/code&gt;  创建的  &lt;code&gt;Job&lt;/code&gt;  的并发执行。只允许指定下面策略中的一种：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Allow&lt;/code&gt;  （默认）：允许并发运行  &lt;code&gt;Job&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Forbid&lt;/code&gt;  ：禁止并发运行，如果前一个还没有完成，则直接跳过下一个&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Replace&lt;/code&gt;  ：取消当前正在运行的  &lt;code&gt;Job&lt;/code&gt; ，用一个新的来替换。&lt;br&gt;
注意，当前策略只能应用于同一个  &lt;code&gt;Cron Job&lt;/code&gt;  创建的  &lt;code&gt;Job&lt;/code&gt; 。如果存在多个  &lt;code&gt;Cron Job&lt;/code&gt; ，它们创建的  &lt;code&gt;Job&lt;/code&gt;  之间总是允许并发运行。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spec.suspend&lt;/code&gt;  ：挂起，该字段也是可选的。如果设置为  &lt;code&gt;true&lt;/code&gt;  ，后续所有执行都会被挂起。它对已经开始执行的  &lt;code&gt;Job&lt;/code&gt;  不起作用。默认值为  &lt;code&gt;false&lt;/code&gt;  。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spec.successfulJobsHistoryLimit&lt;/code&gt;  和  &lt;code&gt;.spec.failedJobsHistoryLimit&lt;/code&gt;  ：历史限制，是可选的字段。它们指定了可以保留多少完成和失败的  &lt;code&gt;Job&lt;/code&gt; 。默认情况下，它们分别设置为  &lt;code&gt;3&lt;/code&gt;  和  &lt;code&gt;1&lt;/code&gt;  。设置限制的值为  &lt;code&gt;0&lt;/code&gt;  ，相关类型的  &lt;code&gt;Job&lt;/code&gt;  完成后将不会被保留。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;实验-4&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验-4&#34;&gt;#&lt;/a&gt; 实验&lt;/h4&gt;
&lt;h5 id=&#34;创建-cronjob&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建-cronjob&#34;&gt;#&lt;/a&gt; 创建  &lt;code&gt;CronJob&lt;/code&gt;&lt;/h5&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;batch/v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CronJob&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cron-job-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;schedule:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;*/1 * * * *&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;jobTemplate:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;cron-job-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;busybox&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;attr&#34;&gt;args:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;-c&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;date;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;hello ,I‘m from K8s cluster.&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;restartPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;OnFailure&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-20.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后可以查看一个 &lt;code&gt;pod&lt;/code&gt;  的运行情况:&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/04-21.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;每个 &lt;code&gt;job&lt;/code&gt;  都是相隔一分钟执行一次。&lt;/p&gt;
&lt;h3 id=&#34;statefulset&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#statefulset&#34;&gt;#&lt;/a&gt;  &lt;code&gt;StatefulSet&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;StatefulSet&lt;/code&gt;  作为  &lt;code&gt;Controller&lt;/code&gt;  为  &lt;code&gt;Pod&lt;/code&gt;  提供唯一的标识。它可以保证部署和  &lt;code&gt;scale&lt;/code&gt;  的顺序&lt;br&gt;
 &lt;code&gt;StatefulSet&lt;/code&gt;  是为了解决有状态服务的问题 (对应  &lt;code&gt;Deployments&lt;/code&gt;  和  &lt;code&gt;ReplicaSets&lt;/code&gt;  是为无状态服务而设计)，其应用 场景包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;稳定的持久化存储，即 &lt;code&gt;Pod&lt;/code&gt;  重新调度后还是能访问到相同的持久化数据，基于 &lt;code&gt;PVC&lt;/code&gt;  来实现 稳定的网络标志，即 &lt;code&gt;Pod&lt;/code&gt;  重新调度后其 &lt;code&gt;PodName&lt;/code&gt;  和 &lt;code&gt;HostName&lt;/code&gt;  不变，基于 &lt;code&gt;Headless Service&lt;/code&gt;  (即没有  &lt;code&gt;Cluster IP&lt;/code&gt;  的 &lt;code&gt;Service&lt;/code&gt; ) 来实现。&lt;/li&gt;
&lt;li&gt;有序部署，有序扩展，即 &lt;code&gt;Pod&lt;/code&gt;  是有顺序的，在部署或者扩展的时候要依据定义的顺序依次依次进行 (即从 &lt;code&gt;0&lt;/code&gt;  到  &lt;code&gt;N-1&lt;/code&gt; ，在下一个 &lt;code&gt;Pod&lt;/code&gt;  运行之前所有之前的 &lt;code&gt;Pod&lt;/code&gt;  必须都是 &lt;code&gt;Running&lt;/code&gt;  和 &lt;code&gt;Ready&lt;/code&gt;  状态)，基于 &lt;code&gt;init containers&lt;/code&gt;  来实 现&lt;br&gt;
有序收缩，有序删除 (即从 &lt;code&gt;N-1&lt;/code&gt;  到 &lt;code&gt;0&lt;/code&gt; )&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;horizontal-pod-autoscaling&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#horizontal-pod-autoscaling&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Horizontal Pod Autoscaling&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;应用的资源使用率通常都有高峰和低谷的时候，如何削峰填谷，提高集群的整体资源利用率，让 &lt;code&gt;service&lt;/code&gt;  中的 &lt;code&gt;Pod&lt;/code&gt;  个数自动调整呢？这就有赖于 &lt;code&gt;Horizontal Pod Autoscaling&lt;/code&gt;  了，顾名思义，使 &lt;code&gt;Pod&lt;/code&gt;  水平自动缩放&lt;/p&gt;
&lt;p&gt;文中所有的 &lt;code&gt;k8s yaml&lt;/code&gt;  配置文件均可从  &lt;code&gt;https://github.com/fangjiaxiaobai/k8s/tree/main/yamls&lt;/code&gt;  获取。&lt;/p&gt;
&lt;h2 id=&#34;最后&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#最后&#34;&gt;#&lt;/a&gt; 最后&lt;/h2&gt;
&lt;p&gt;希望和你一起遇见更好的自己&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/qrcode.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://fangjiaxiaobai.github.io/2022/07/31/k8s/seris03-pod-lifecycle/</guid>
            <title>k8s-Pod的生命周期</title>
            <link>https://fangjiaxiaobai.github.io/2022/07/31/k8s/seris03-pod-lifecycle/</link>
            <category>k8s</category>
            <category>kubernetes</category>
            <pubDate>Sun, 31 Jul 2022 18:18:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;code&gt;K8s&lt;/code&gt;  中所有的内容都抽象为资源，资源实例化为对象。&lt;/p&gt;
&lt;h2 id=&#34;集群资源的分类&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#集群资源的分类&#34;&gt;#&lt;/a&gt; 集群资源的分类&lt;/h2&gt;
&lt;h3 id=&#34;名称空间级别&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#名称空间级别&#34;&gt;#&lt;/a&gt; 名称空间级别&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;工作负载型资源 (  &lt;code&gt;workload&lt;/code&gt;  )：  &lt;code&gt;Pod&lt;/code&gt; 、 &lt;code&gt;ReplicaSet&lt;/code&gt; 、 &lt;code&gt;Deployment&lt;/code&gt; 、 &lt;code&gt;StatefulSet&lt;/code&gt; 、 &lt;code&gt;DaemonSet、Job&lt;/code&gt; 、  &lt;code&gt;CronJob&lt;/code&gt;  (  &lt;code&gt;ReplicationController&lt;/code&gt;  在  &lt;code&gt;v1.11&lt;/code&gt;  版本被废弃 )&lt;/li&gt;
&lt;li&gt;服务发现及负载均衡型资源 (  &lt;code&gt;ServiceDiscovery LoadBalance&lt;/code&gt;  ):  &lt;code&gt;Service&lt;/code&gt; 、 &lt;code&gt;Ingress&lt;/code&gt; 、…&lt;/li&gt;
&lt;li&gt;配置与存储型资源： &lt;code&gt; Volume&lt;/code&gt;  (存储卷)、 &lt;code&gt;CSI&lt;/code&gt;  (容器存储接口，可以扩展各种各样的第三方存储卷)&lt;/li&gt;
&lt;li&gt;特殊类型的存储卷： &lt;code&gt;ConfigMap&lt;/code&gt;  (当配置中心来使用的资源类型)、 &lt;code&gt;Secret&lt;/code&gt;  (保存敏感数据)、  &lt;code&gt;DownwardAPI&lt;/code&gt;  (把外部环境中的信息输出给容器)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;集群级别&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#集群级别&#34;&gt;#&lt;/a&gt; 集群级别&lt;/h3&gt;
&lt;p&gt;一旦定义在集群内都可见。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Namespace&lt;/code&gt; ,  &lt;code&gt;Node&lt;/code&gt; ,  &lt;code&gt;Role&lt;/code&gt; ,  &lt;code&gt;ClusterRole&lt;/code&gt; ,  &lt;code&gt;RoleBindiing&lt;/code&gt; ,  &lt;code&gt;ClusterRoleBinding&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;元数据型&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#元数据型&#34;&gt;#&lt;/a&gt; 元数据型&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;HPA&lt;/code&gt; 、 &lt;code&gt;PodTemplate&lt;/code&gt; 、 &lt;code&gt;LimitRange&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;k8s&lt;/code&gt;  中，一般使用  &lt;code&gt;yaml&lt;/code&gt;  格式的文件来创建符合我们预期期望的 &lt;code&gt;pod&lt;/code&gt; , 这样的  &lt;code&gt;yaml&lt;/code&gt;  文件，我们一般成为 资源清单。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;apiVersion&lt;/code&gt; :   &lt;code&gt;String&lt;/code&gt; ,  &lt;code&gt;K8s Api&lt;/code&gt;  的版本，可以用 &lt;code&gt;kubectl api-versions&lt;/code&gt;  命令查询&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kind&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; ,  &lt;code&gt;yaml&lt;/code&gt;  定义的资源类型和角色&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metadata&lt;/code&gt; :  &lt;code&gt;Object&lt;/code&gt; , 元数据对象，固定值就写  &lt;code&gt;metadata&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; : 元数据对象的名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;namespace&lt;/code&gt; : 元数据对象的命名空间，有我们自身定义&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spec&lt;/code&gt; : &lt;code&gt;Object&lt;/code&gt;  详细定义对象，固定值是 &lt;code&gt;Spec&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;containers[]&lt;/code&gt; :  &lt;code&gt;list&lt;/code&gt;  类型，这里是 &lt;code&gt;spec&lt;/code&gt;  对象的容器列表定义，是个列表
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 这里是定义容器的名字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;image&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 这里定义要用到的镜像名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;imagePullPolicy&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 定义镜像拉取策略，有 &lt;code&gt;Always&lt;/code&gt; , &lt;code&gt;Never&lt;/code&gt; , &lt;code&gt;IfNotPresent&lt;/code&gt; , 三个值。默认是  &lt;code&gt;Always&lt;/code&gt; .
&lt;ul&gt;
&lt;li&gt;1、 &lt;code&gt;Always&lt;/code&gt; : 每次都尝试拉取镜像&lt;/li&gt;
&lt;li&gt;2、 &lt;code&gt;Never&lt;/code&gt; : 表示仅使用本地镜像&lt;/li&gt;
&lt;li&gt;3、 &lt;code&gt;IfNotPresent&lt;/code&gt; : 如果本地有镜像就使用本地镜像，没有就拉取在线镜像。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;command[]&lt;/code&gt; ,  &lt;code&gt;List&lt;/code&gt; , 容器启动命令，因为是数据可以指定多个，不指定则使用镜像打包时使用的启动命令&lt;/li&gt;
&lt;li&gt;&lt;code&gt;args&lt;/code&gt; :  &lt;code&gt;List，&lt;/code&gt;  指定容器启动的命令参数，可以指定多个&lt;/li&gt;
&lt;li&gt;&lt;code&gt;workingDir&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 指定容器的工作目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;volumeMountsp[]&lt;/code&gt; ,  &lt;code&gt;List&lt;/code&gt; : 指定容器内部的存储卷配置
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 指定可以挂载的存储卷的名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mountPath&lt;/code&gt; ,  &lt;code&gt;String&lt;/code&gt; , 指定可以被容器挂载的存储卷的路径&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readOnly&lt;/code&gt; ,  &lt;code&gt;String&lt;/code&gt; , 设置存储卷路径的读写模型，  &lt;code&gt;true&lt;/code&gt;  或者  &lt;code&gt;false&lt;/code&gt; .&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ports[]&lt;/code&gt; ,  &lt;code&gt;List&amp;lt;Object&amp;gt;&lt;/code&gt;  , 指定容器使用的端口列表
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 端口名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;containerPort&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 容器你需要监听的端口号&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hostPort&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 指定容器所在主机需要监听的端口号，默认跟上面  &lt;code&gt;containerPort&lt;/code&gt;  相同， 注意设置了  &lt;code&gt;hostPort&lt;/code&gt;  同一台主机无法启动该容器的相同副本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;protocol&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 指定端口协议，支持  &lt;code&gt;TCP&lt;/code&gt; , &lt;code&gt;UDP&lt;/code&gt; , 默认是  &lt;code&gt;TCP&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;env[]&lt;/code&gt; : &lt;code&gt;List&amp;lt;Object&amp;gt;&lt;/code&gt;  , 指定容器运行前需要设置的环境变量列表
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 环境变量名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;value&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 环境变量值&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;resources&lt;/code&gt; :  &lt;code&gt;Object&lt;/code&gt; , 指定资源限制和资源请求的值
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;limits&lt;/code&gt; : 设置容器运行时的资源的运行上限
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cpu&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; ,  &lt;code&gt;CPU&lt;/code&gt;  的限制，单位为  &lt;code&gt;core&lt;/code&gt;  数，将用于  &lt;code&gt;docker run --cpu-shares&lt;/code&gt;  参数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;memory&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; ,  &lt;code&gt;Mem&lt;/code&gt;  内存的限制，单位为  &lt;code&gt;MIB&lt;/code&gt; , &lt;code&gt;GiB&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;requests&lt;/code&gt; :  &lt;code&gt;Object&lt;/code&gt; , 指定容器启动和调度时的限制设置
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cpu&lt;/code&gt; :  &lt;code&gt;m&lt;/code&gt; ,   &lt;code&gt;CPU&lt;/code&gt;  请求。单位为 &lt;code&gt;core&lt;/code&gt;  数，容器启动时初始化可用数量&lt;/li&gt;
&lt;li&gt;&lt;code&gt;memory&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 内存请求，单位  &lt;code&gt;MIB&lt;/code&gt; ,  &lt;code&gt;Gib&lt;/code&gt; , 容器启动的初始化可用数量&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;restartPolicy&lt;/code&gt; :  &lt;code&gt;String&lt;/code&gt; , 定义 Pod 的重启策略，可选值是  &lt;code&gt;Always&lt;/code&gt; ,  &lt;code&gt;OnFailure&lt;/code&gt; , 默认值是  &lt;code&gt;Always&lt;/code&gt; .
&lt;ul&gt;
&lt;li&gt;1. &lt;code&gt;Always&lt;/code&gt; :  &lt;code&gt;Pod&lt;/code&gt;  一旦终止运行，则无论容器是否终止，  &lt;code&gt;kubelet&lt;/code&gt;  服务都将重启它。&lt;/li&gt;
&lt;li&gt;2、 &lt;code&gt;OnFailure&lt;/code&gt; : 只有 &lt;code&gt;Pod&lt;/code&gt;  以非 &lt;code&gt;0&lt;/code&gt;  退出码终止时，  &lt;code&gt;kubelet&lt;/code&gt;  才会重启该容器，如果容器正常结束，则不会重启&lt;/li&gt;
&lt;li&gt;3、 &lt;code&gt;Never&lt;/code&gt; .  &lt;code&gt;Pod&lt;/code&gt;  终止后， &lt;code&gt;kubelet&lt;/code&gt;  将退出码报告给 &lt;code&gt;Master&lt;/code&gt; ，不会重启 &lt;code&gt;Pod&lt;/code&gt; .&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nodeSelector&lt;/code&gt; :  &lt;code&gt;Object&lt;/code&gt; , 定义 &lt;code&gt;Node&lt;/code&gt;  的 &lt;code&gt;label&lt;/code&gt;  过滤标签，已 &lt;code&gt;key&lt;/code&gt; , &lt;code&gt;value&lt;/code&gt;  的格式指定。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;imagePullSecrets&lt;/code&gt; :  &lt;code&gt;Object&lt;/code&gt; , 定义 &lt;code&gt;pull&lt;/code&gt;  镜像时使用 Secret 名称，以 &lt;code&gt;name:secretKey&lt;/code&gt;  格式指定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hostNetwork&lt;/code&gt; :  &lt;code&gt;Boolean&lt;/code&gt; , 定义是否使用主机网络，默认值为 &lt;code&gt;false&lt;/code&gt; , 设置为 &lt;code&gt;true&lt;/code&gt;  表示使用宿主机网络， 不使用 &lt;code&gt;docker&lt;/code&gt;  网桥，同时设置了 &lt;code&gt;true&lt;/code&gt;  将无法在同一台宿主机上启动第二个副本。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以通过下面的命令实时查看 yaml 的配置内容&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl explain pod.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;案例&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#案例&#34;&gt;#&lt;/a&gt; 案例&lt;/h3&gt;
&lt;p&gt;通过资源清单创建一个 pod.&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;sample-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;myapp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt;   &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;my-app&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用  &lt;code&gt;kubectl create -f 01-sample-yaml.yaml&lt;/code&gt;  创建&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-02.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用命令  &lt;code&gt;kubectl get pods -o wide&lt;/code&gt;  查看下 &lt;code&gt;pod&lt;/code&gt;  的 &lt;code&gt;ip&lt;/code&gt;  和 状态:&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-03.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后使用   &lt;code&gt;curl 10.244.154.195&lt;/code&gt;  可以看到&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-04.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;正常返回了  &lt;code&gt;Nginx&lt;/code&gt;  的首页信息。&lt;/p&gt;
&lt;h2 id=&#34;pod-的生命周期&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#pod-的生命周期&#34;&gt;#&lt;/a&gt;  &lt;code&gt;Pod&lt;/code&gt;  的生命周期&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-05.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;如上图， &lt;code&gt;pod&lt;/code&gt;  的启动过程是:  &lt;code&gt;pod&lt;/code&gt;  创建时会首先创建一个  &lt;code&gt;pause&lt;/code&gt;  容器。然后执行创建多个  &lt;code&gt;Init&lt;/code&gt;  容器，然后再启动 主容器，也就是一般我们使用镜像创建起来的具有业务属性的容器，称为主容器。 主容器会经历  &lt;code&gt;Start-&amp;gt;Running-&amp;gt;Stop&lt;/code&gt; , 这些状态。&lt;/p&gt;
&lt;h3 id=&#34;pause-容器&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#pause-容器&#34;&gt;#&lt;/a&gt; Pause 容器&lt;/h3&gt;
&lt;p&gt;从名字上看， &lt;code&gt;pause&lt;/code&gt;  是一个 &amp;quot;暂停&amp;quot; 的容器，它的作用是：解决 &lt;code&gt;pod&lt;/code&gt;  的网络和存储的问题。 &lt;code&gt;pause&lt;/code&gt;  容器称为  &lt;code&gt;Infra Container&lt;/code&gt; , 其他的容器称为业务容器.   &lt;code&gt;Infra container&lt;/code&gt;  是一个非常小的镜像，大概  &lt;code&gt;700KB &lt;/code&gt; 左右，是一个 &lt;code&gt;C&lt;/code&gt;  语言写的、永远处于 “暂停” 状态的容器。由于有了这样一个  &lt;code&gt;Infra container&lt;/code&gt;  之后，其他所有容器都会通过  &lt;code&gt;Join Namespace&lt;/code&gt;  的方式加入到  &lt;code&gt;Infra container&lt;/code&gt;  的  &lt;code&gt;Network Namespace&lt;/code&gt;  中。&lt;/p&gt;
&lt;h3 id=&#34;init-容器&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#init-容器&#34;&gt;#&lt;/a&gt; Init 容器&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Pod&lt;/code&gt;  能够具有多个容器，应用运行在容器里面，但是它也可能有一个或多个先于应用容器启动的 &lt;code&gt;Init&lt;/code&gt;  容器。&lt;br&gt;
 &lt;code&gt;Init&lt;/code&gt;  容器与普通的容器非常像，除了如下两点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Init&lt;/code&gt;  容器总是运行到成功完成为止&lt;/li&gt;
&lt;li&gt;每个  &lt;code&gt;Init&lt;/code&gt;  容器都必须在下一个  &lt;code&gt;Init&lt;/code&gt;  容器启动之前成功完成&lt;br&gt;
如果  &lt;code&gt;Pod&lt;/code&gt;  的  &lt;code&gt;Init&lt;/code&gt;  容器失败， &lt;code&gt;Kubernetes&lt;/code&gt;    &lt;code&gt;Pod&lt;/code&gt; ，直到  &lt;code&gt;Init&lt;/code&gt;  容器成功为止。然而，如果  &lt;code&gt;Pod&lt;/code&gt;  对应的  &lt;code&gt;restartPolicy&lt;/code&gt;  为  &lt;code&gt;Never&lt;/code&gt; ，它不会重新启动&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因为  &lt;code&gt;Init&lt;/code&gt;  容器具有与应用程序容器分离的单独镜像，所以它们的启动相关代码具有如下优势：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;它们可以包含并运行实用工具，但是出于安全考虑，是不建议在应用程序容器镜像中包含这&lt;br&gt;
些实用工具的&lt;/li&gt;
&lt;li&gt;它们可以包含使用工具和定制化代码来安装，但是不能出现在应用程序镜像中。例如，创建镜像没必要  &lt;code&gt;FROM&lt;/code&gt;  另一个镜像，只需要在安装过程中使用类似  &lt;code&gt;sed&lt;/code&gt; 、  &lt;code&gt;awk&lt;/code&gt; 、  &lt;code&gt;python&lt;/code&gt;  或  &lt;code&gt;dig&lt;/code&gt;  这样的工具。&lt;/li&gt;
&lt;li&gt;应用程序镜像可以分离出创建和部署的角色，而没有必要联合它们构建一个单独的镜像。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Init&lt;/code&gt;  容器使用  &lt;code&gt;Linux Namespace&lt;/code&gt; ，所以相对应用程序容器来说具有不同的文件系统视图。因此，它们能够具有访问  &lt;code&gt;Secret&lt;/code&gt;  的权限，而应用程序容器则不能。&lt;/li&gt;
&lt;li&gt;它们必须在应用程序容器启动之前运行完成，而应用程序容器是并行运行的，所以  &lt;code&gt;Init&lt;/code&gt;  容器能够提供了一种简单的阻塞或延迟应用容器的启动的方法，直到满足了一组先决条件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;init小实验&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#init小实验&#34;&gt;#&lt;/a&gt;  &lt;code&gt;init&lt;/code&gt;  小实验。&lt;/h4&gt;
&lt;p&gt;实验目的:  &lt;code&gt;init&lt;/code&gt;  容器会依次启动，只有  &lt;code&gt;init&lt;/code&gt;  容器启动完成之后， 主容器才会启动.&lt;/p&gt;
&lt;h5 id=&#34;实验步骤&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验步骤&#34;&gt;#&lt;/a&gt; 实验步骤&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;创建  &lt;code&gt;pod&lt;/code&gt; .&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  的状态变化&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  中  &lt;code&gt;initC&lt;/code&gt;  的日志&lt;/li&gt;
&lt;li&gt;创建  &lt;code&gt;Service-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  的状态变化&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  中  &lt;code&gt;initC&lt;/code&gt;  的日志&lt;/li&gt;
&lt;li&gt;创建  &lt;code&gt;Service-2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  的状态变化&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  中  &lt;code&gt;initC&lt;/code&gt;  的日志&lt;/li&gt;
&lt;li&gt;查看  &lt;code&gt;pod&lt;/code&gt;  的日志&lt;/li&gt;
&lt;/ul&gt;
&lt;h6 id=&#34;创建-pod&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建-pod&#34;&gt;#&lt;/a&gt; 创建  &lt;code&gt;pod&lt;/code&gt; .&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;02-init-demo.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;init-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;labels:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;app:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;init-app&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;my-init-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;quot;sh&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;-c&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;echo the app is running! &amp;amp;&amp;amp; sleep 3600&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;initContainers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;init-myservice-1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;busybox&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;#x27;sh&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;until nslookup my-service-1; do echo &amp;#x27;waiting for my-service-1&amp;#x27;; sleep 2; done;&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;init-myservice-2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;busybox&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;#x27;sh&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;until nslookup my-service-2; do echo &amp;#x27;waiting for my-service-2&amp;#x27;; sleep 2; done;&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用命令  &lt;code&gt;kubectl create -f 02-init-demo.yaml&lt;/code&gt;  创建  &lt;code&gt;pod&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;新开一个窗口使用  &lt;code&gt;kubectl get pods -w -o wide&lt;/code&gt;  命令 查看 pod 的启动变化.&lt;br&gt;
&lt;img data-src=&#34;/images/k8s/03-07.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h6 id=&#34;查看查看-pod-中init-c-1的日志&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#查看查看-pod-中init-c-1的日志&#34;&gt;#&lt;/a&gt; 查看查看  &lt;code&gt;pod&lt;/code&gt;  中 &lt;code&gt;init-c-1&lt;/code&gt;  的日志&lt;/h6&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-08.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;发现  &lt;code&gt;initC-1&lt;/code&gt;  一直在  &lt;code&gt;nslookup&lt;/code&gt;  查找  &lt;code&gt;my-service-1&lt;/code&gt; .&lt;/p&gt;
&lt;h6 id=&#34;创建-service-1&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建-service-1&#34;&gt;#&lt;/a&gt; 创建  &lt;code&gt;Service-1&lt;/code&gt;&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;02-init-demo-my-service-01.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;my-service-1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;8080&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用命令  &lt;code&gt;kubectl create -f 02-init-demo-my-service-01.yaml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;查看  &lt;code&gt;pod&lt;/code&gt;  中第一个  &lt;code&gt;InitC&lt;/code&gt;  的日志&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-08.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;会出现&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Server:		10.96.0.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Address:	10.96.0.10:53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Name:	my-service-1.default.svc.cluster.local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Address: 10.108.140.48&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后查看  &lt;code&gt;pod&lt;/code&gt;  的状态。会出现一条：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;init-demo   0/1     Init:1/2   0          4m1s   10.244.154.204   k8s-node-01   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&#34;创建-service-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建-service-2&#34;&gt;#&lt;/a&gt; 创建  &lt;code&gt;Service-2&lt;/code&gt;&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;02-init-demo-my-service-02.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;my-service-2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;protocol:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;TCP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;attr&#34;&gt;targetPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;8080&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用命令  &lt;code&gt;kubectl create -f 02-init-demo-my-service-01.yaml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;查看  &lt;code&gt;pod&lt;/code&gt;  中第二个 &lt;code&gt;InitC&lt;/code&gt;  的日志直到出现&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Server:		10.96.0.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Address:	10.96.0.10:53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Name:	my-service-2.default.svc.cluster.local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Address: 10.107.13.223&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后查看  &lt;code&gt;pod&lt;/code&gt;  的状态。会出现一条：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;init-demo   0/1     PodInitializing   0          6m52s   10.244.154.204   k8s-node-01   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后就会启动  &lt;code&gt;pod&lt;/code&gt;  . 最终出现&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;init-demo   1/1     Running           0          6m53s   10.244.154.204   k8s-node-01   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后查看  &lt;code&gt;pod&lt;/code&gt;  的日志，会输出  &lt;code&gt;the app is running.&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[root@k8s-master-01 k8s-yamls]# kubectl logs -f init-demo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Defaulted container &amp;quot;my-init-demo&amp;quot; out of: my-init-demo, init-myservice-1 (init), init-myservice-2 (init)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;the app is running!&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&#34;关于init容器的特殊说明&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#关于init容器的特殊说明&#34;&gt;#&lt;/a&gt; 关于 init 容器的特殊说明&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;在  &lt;code&gt;Pod&lt;/code&gt;  启动过程中，  &lt;code&gt;Init&lt;/code&gt;  容器会按顺序在网络和数据卷初始化之后启动。每个容器必须在下一个容器启动之前成功退出&lt;/li&gt;
&lt;li&gt;如果由于运行时或失败退出，将导致容器启动失败，它会根据  &lt;code&gt;Pod&lt;/code&gt;  的  &lt;code&gt;restartPolicy&lt;/code&gt;  指定的策略 进行重试。然而，如果  &lt;code&gt;Pod&lt;/code&gt;  的  &lt;code&gt;restartPolicy&lt;/code&gt;  设置为  &lt;code&gt;Always&lt;/code&gt; ， &lt;code&gt;Init&lt;/code&gt;  容器失败时会使用  &lt;code&gt;RestartPolicy&lt;/code&gt;  策略&lt;/li&gt;
&lt;li&gt;在所有的  &lt;code&gt;Init&lt;/code&gt;  容器没有成功之前， &lt;code&gt;Pod&lt;/code&gt;  将不会变成  &lt;code&gt;Ready&lt;/code&gt;  状态。 &lt;code&gt;Init&lt;/code&gt;  容器的端口将不会在  &lt;code&gt;Service&lt;/code&gt;  中进行聚集。 正在初始化中的  &lt;code&gt;Pod&lt;/code&gt;  处于  &lt;code&gt;Pending&lt;/code&gt;  状态，但应该会将  &lt;code&gt;Initializing&lt;/code&gt;  状态设置为  &lt;code&gt;true&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;如果  &lt;code&gt;Pod&lt;/code&gt;  重启，所有  &lt;code&gt;Init&lt;/code&gt;  容器必须重新执行&lt;/li&gt;
&lt;li&gt;对  &lt;code&gt;Init&lt;/code&gt;  容器  &lt;code&gt;spec&lt;/code&gt;  的修改被限制在容器  &lt;code&gt;image&lt;/code&gt;  字段，修改其他字段都不会生效。更改  &lt;code&gt;Init&lt;/code&gt;  容器的  &lt;code&gt;image&lt;/code&gt;  字段，等价于重启该  &lt;code&gt;Pod&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Init&lt;/code&gt;  容器具有应用容器的所有字段。除了  &lt;code&gt;readinessProbe&lt;/code&gt;  ，因为  &lt;code&gt;Init&lt;/code&gt;  容器无法定义不同于完成 ( &lt;code&gt;completion&lt;/code&gt; ) 的就绪（ &lt;code&gt;readiness&lt;/code&gt; ）之外的其他状态。这会在验证过程中强制执行&lt;/li&gt;
&lt;li&gt;在  &lt;code&gt;Pod&lt;/code&gt;  中的每个  &lt;code&gt;app&lt;/code&gt;  和  &lt;code&gt;Init&lt;/code&gt;  容器的名称必须唯一；与任何其它容器共享同一个名称，会在验证时抛出错误.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;探针检测&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#探针检测&#34;&gt;#&lt;/a&gt; 探针检测&lt;/h2&gt;
&lt;p&gt;探针是由  &lt;code&gt;kubelet&lt;/code&gt;  对容器执行的定期诊断。要执行诊断， &lt;code&gt;kubelet&lt;/code&gt;  调用由容器实现的  &lt;code&gt;Handler&lt;/code&gt; 。有三种类型的处理程序：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ExecAction&lt;/code&gt; ：在容器内执行指定命令。如果命令退出时返回码为  &lt;code&gt;0&lt;/code&gt;  则认为诊断成功。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TCPSocketAction&lt;/code&gt; ：对指定端口上的容器的  &lt;code&gt;IP&lt;/code&gt;  地址进行  &lt;code&gt;TCP&lt;/code&gt;  检查。如果端口打开，则诊断被认为是成功的。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTPGetAction&lt;/code&gt; ：对指定的端口和路径上的容器的  &lt;code&gt;IP&lt;/code&gt;  地址执行  &lt;code&gt;HTTP Get&lt;/code&gt;  请求。如果响应的状态码大于等于  &lt;code&gt;200&lt;/code&gt;  且小于  &lt;code&gt;400&lt;/code&gt; ，则诊断被认为是成功的&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每次探测都将获得以下三种结果之一：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;成功：容器通过了诊断。&lt;/li&gt;
&lt;li&gt;失败：容器未通过诊断。&lt;/li&gt;
&lt;li&gt;未知：诊断失败，因此不会采取任何行动&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;探测的方式&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#探测的方式&#34;&gt;#&lt;/a&gt; 探测的方式&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;livenessProbe&lt;/code&gt; ：指示容器是否正在运行。如果存活探测失败，则  &lt;code&gt;kubelet&lt;/code&gt;  会杀死容器，并且容器将受到其 重启策略 的影响。如果容器不提供存活探针，则默认状态为  &lt;code&gt;Success&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readinessProbe&lt;/code&gt; ：指示容器是否准备好服务请求。如果就绪探测失败，端点控制器将从与  &lt;code&gt;Pod&lt;/code&gt;  匹配的所有  &lt;code&gt;Service&lt;/code&gt;  的端点中删除该  &lt;code&gt;Pod&lt;/code&gt;  的  &lt;code&gt;IP&lt;/code&gt;  地址。初始延迟之前的就绪状态默认为  &lt;code&gt;Failure&lt;/code&gt; 。如果容器不提供就绪探针，则默认状态为  &lt;code&gt;Success&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;pod-hook&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#pod-hook&#34;&gt;#&lt;/a&gt; Pod Hook&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Pod hook&lt;/code&gt; （钩子）是由  &lt;code&gt;Kubernetes&lt;/code&gt;  管理的  &lt;code&gt;kubelet&lt;/code&gt;  发起的，当容器中的进程启动前或者容器中的进程终止之前运行，这是包含在容器的生命周期之中。可以同时为  &lt;code&gt;Pod&lt;/code&gt;  中的所有容器都配置  &lt;code&gt;hook&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Hook&lt;/code&gt;  的类型包括两种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;exec&lt;/code&gt; ：执行一段命令&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP&lt;/code&gt; ：发送 &lt;code&gt;HTTP&lt;/code&gt;  请求&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;PodSpec&lt;/code&gt;  中有一个  &lt;code&gt;restartPolicy&lt;/code&gt;  字段，可能的值为  &lt;code&gt;Always&lt;/code&gt; 、 &lt;code&gt;OnFailure&lt;/code&gt;  和  &lt;code&gt;Never&lt;/code&gt; 。默认为 &lt;code&gt;Always&lt;/code&gt; 。  &lt;code&gt;restartPolicy&lt;/code&gt;  适用于  &lt;code&gt;Pod&lt;/code&gt;  中的所有容器。 &lt;code&gt;restartPolicy&lt;/code&gt;  仅指通过同一节点上的  &lt;code&gt;kubelet&lt;/code&gt;  重新启动容器。失败的容器由  &lt;code&gt;kubelet&lt;/code&gt;  以五分钟为上限的指数退避延迟（ &lt;code&gt;10秒&lt;/code&gt; ， &lt;code&gt;20秒&lt;/code&gt; ， &lt;code&gt;40秒&lt;/code&gt; …）重新启动，并在成功执行十分钟后重置。如  &lt;code&gt;Pod&lt;/code&gt;  文档 中所述，一旦绑定到一个节点， &lt;code&gt;Pod&lt;/code&gt;  将永远不会重新绑定到另一个节点。&lt;/p&gt;
&lt;h4 id=&#34;pod-phase&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#pod-phase&#34;&gt;#&lt;/a&gt; Pod phase&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Pod&lt;/code&gt;  的  &lt;code&gt;status&lt;/code&gt;  字段是一个  &lt;code&gt;PodStatus&lt;/code&gt;  对象， &lt;code&gt;PodStatus&lt;/code&gt;  中有一个  &lt;code&gt;phase&lt;/code&gt;  字段。&lt;br&gt;
 &lt;code&gt;PodStatus&lt;/code&gt;  的相位（ &lt;code&gt;phase&lt;/code&gt; ）是  &lt;code&gt;Pod&lt;/code&gt;  在其生命周期中的简单宏观概述。该阶段并不是对容器或  &lt;code&gt;Pod&lt;/code&gt;  的综合汇总，也不是为了做为综合状态机 &lt;code&gt;Pod&lt;/code&gt;  相位的数量和含义是严格指定的。除了本文档中列举的状态外，不应该再假定  &lt;code&gt;Pod&lt;/code&gt;  有其他的  &lt;code&gt;phase&lt;/code&gt;  值&lt;/p&gt;
&lt;h5 id=&#34;phase的值&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#phase的值&#34;&gt;#&lt;/a&gt; phase 的值&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;挂起（ &lt;code&gt;Pending&lt;/code&gt; ）： &lt;code&gt;Pod&lt;/code&gt;  已被  &lt;code&gt;Kubernetes&lt;/code&gt;  系统接受，但有一个或者多个容器镜像尚未创建。等待时间包括调度  &lt;code&gt;Pod&lt;/code&gt;  的时间和通过网络下载镜像的时间，这可能需要花点时间&lt;/li&gt;
&lt;li&gt;运行中（ &lt;code&gt;Running&lt;/code&gt; ）：该  &lt;code&gt;Pod&lt;/code&gt;  已经绑定到了一个节点上， &lt;code&gt;Pod&lt;/code&gt;  中所有的容器都已被创建。至少有一个容器正在运行，或者正处于启动或重启状态&lt;/li&gt;
&lt;li&gt;成功（ &lt;code&gt;Succeeded&lt;/code&gt; ）： &lt;code&gt;Pod&lt;/code&gt;  中的所有容器都被成功终止，并且不会再重启&lt;/li&gt;
&lt;li&gt;失败（ &lt;code&gt;Failed&lt;/code&gt; ）： &lt;code&gt;Pod&lt;/code&gt;  中的所有容器都已终止了，并且至少有一个容器是因为失败终止。也就是说，容器以非  &lt;code&gt;0&lt;/code&gt;  状态退出或者被系统终止&lt;/li&gt;
&lt;li&gt;未知（ &lt;code&gt;Unknown&lt;/code&gt; ）：因为某些原因无法取得  &lt;code&gt;Pod&lt;/code&gt;  的状态，通常是因为与  &lt;code&gt;Pod&lt;/code&gt;  所在主机通信失败&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;两个小实验&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#两个小实验&#34;&gt;#&lt;/a&gt; 两个小实验&lt;/h3&gt;
&lt;h4 id=&#34;readiness&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#readiness&#34;&gt;#&lt;/a&gt; Readiness&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;03-readness-demo.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;readness-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;readness-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IfNotPresent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;readinessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/index.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-09.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到  &lt;code&gt;readness-demo&lt;/code&gt;  正常启动成功，也已经 &lt;code&gt;ready&lt;/code&gt;  了。&lt;/p&gt;
&lt;p&gt;下面删掉  &lt;code&gt;readness-demo&lt;/code&gt;  这个 &lt;code&gt;pod&lt;/code&gt;  , 然后把  &lt;code&gt;path:/index.html&lt;/code&gt;  改成  &lt;code&gt;path:/index1.html&lt;/code&gt;  如下:&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;readness-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;readness-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IfNotPresent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;readinessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/index1.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-10.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到  &lt;code&gt;ready: 0/1&lt;/code&gt;  , 我们可以查看一下  &lt;code&gt;pod&lt;/code&gt;  的详细信息.&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-11.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Readiness Failed&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这时，我们进入容器中，新建一个  &lt;code&gt;index1.html&lt;/code&gt;  页面.&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-12.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后查看一下  &lt;code&gt;pod&lt;/code&gt;  的状态。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-13.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;liveness&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#liveness&#34;&gt;#&lt;/a&gt; Liveness&lt;/h4&gt;
&lt;h5 id=&#34;liveness-exec-demo&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#liveness-exec-demo&#34;&gt;#&lt;/a&gt; liveness-exec demo&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;04-liveness-demo-exec.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;liveness-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;liveness-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IfNotPresent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;#x27;/bin/sh&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;touch /tmp/live; sleep 20; rm -rf /tmp/live; sleep 3600;&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;livenessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;exec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;#x27;test&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;-e&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;/tmp/live&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后查看 &lt;code&gt;pod&lt;/code&gt;  的状态&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-14.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;liveness-http-get-demo&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#liveness-http-get-demo&#34;&gt;#&lt;/a&gt; liveness-http-get demo&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;04-liveness-httpGet-demo.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;liveness-http-get-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;liveness-http-get-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;imagePullPolicy:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;IfNotPresent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ports:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http-port&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;containerPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;livenessProbe:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http-port&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/index.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;initialDelaySeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;periodSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;timeoutSeconds:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-15.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后，我们删除 &lt;code&gt;index.html&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl exec liveness-http-get-demo -it -- rm -rf /usr/share/nginx/html/index.html&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;可以发现 pod 进行了重启。如下图 (我删除了两次)&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-16.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;启动和停止&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#启动和停止&#34;&gt;#&lt;/a&gt; 启动和停止&lt;/h3&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-05.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;在 pod 的生命周期中，我们讲完了  &lt;code&gt;pause&lt;/code&gt; ,  &lt;code&gt;initC&lt;/code&gt; ,  &lt;code&gt;liveness&lt;/code&gt; ,  &lt;code&gt;readiness&lt;/code&gt; . 还剩下  &lt;code&gt;Starter&lt;/code&gt;  和  &lt;code&gt;Stop&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;这个也比较简单，我通过下面这个实验来演示一下 pod 的启动和停止。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;05-start-and-stop-demo.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;Pod&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;metadata:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;starter-stop-demo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;namespace:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;containers:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;stop-stop-demo-container&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;image:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;fangjiaxiaobai/my-app:v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;lifecycle:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;postStart:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;exec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;#x27;/bin/sh&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;echo Hello from podStart handler &amp;gt; /usr/share/message&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;preStop:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;exec:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;command:&lt;/span&gt; [&lt;span class=&#34;string&#34;&gt;&amp;#x27;/bin/sh&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;echo Bye from podStop handler&amp;#x27;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后查看一下  &lt;code&gt;/usr/share/message&lt;/code&gt;  文件内容&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/k8s/03-17.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;当然，删除之后，这个容器我们就进不去了，但是我们知道了通过这种方式可以在  &lt;code&gt;pod&lt;/code&gt;  的生命周期的各个阶段中做些操作。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://fangjiaxiaobai.github.io/2022/07/22/k8s/pit01.incompatible-CNI-versions/</guid>
            <title>k8s-incompatible CNI versions</title>
            <link>https://fangjiaxiaobai.github.io/2022/07/22/k8s/pit01.incompatible-CNI-versions/</link>
            <category>k8s</category>
            <category>kubernetes</category>
            <pubDate>Fri, 22 Jul 2022 18:18:00 +0800</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;报错内容&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#报错内容&#34;&gt;#&lt;/a&gt; 报错内容&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Warning  FailedCreatePodSandBox  5m17s kubelet Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; sandbox &lt;span class=&#34;string&#34;&gt;&amp;quot;1ded5da71b38996763e74f28f609d8d8f26a4cc1e4fdd3272312bf3e168e4111&amp;quot;&lt;/span&gt;: plugin &lt;span class=&#34;built_in&#34;&gt;type&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;bridge&amp;quot;&lt;/span&gt; failed (add): incompatible CNI versions; config is &lt;span class=&#34;string&#34;&gt;&amp;quot;1.0.0&amp;quot;&lt;/span&gt;, plugin supports [&lt;span class=&#34;string&#34;&gt;&amp;quot;0.1.0&amp;quot;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;0.2.0&amp;quot;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;0.3.0&amp;quot;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;0.3.1&amp;quot;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;0.4.0&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;部署的环境&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#部署的环境&#34;&gt;#&lt;/a&gt; 部署的环境&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;centos 8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubernetes 1.24.3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;解决问题&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#解决问题&#34;&gt;#&lt;/a&gt; 解决问题&lt;/h3&gt;
&lt;p&gt;这个问题的主要内容是:  &lt;code&gt;incompatible CNI versions&lt;/code&gt; . 当你去网上去搜索解决方案大都是 说 使用  &lt;code&gt;containerd&lt;/code&gt;  的版本不对，也就是说，确实是  &lt;code&gt;CNI&lt;/code&gt;  的版本是有问题的。&lt;/p&gt;
&lt;p&gt;具体的解决方案在官方网站中是这样说的：&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://fangjiaxiaobai.github.io/images/k8s/01-01.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;具体内容可以看这里:&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLWNuL2RvY3MvdGFza3MvYWRtaW5pc3Rlci1jbHVzdGVyL21pZ3JhdGluZy1mcm9tLWRvY2tlcnNoaW0vdHJvdWJsZXNob290aW5nLWNuaS1wbHVnaW4tcmVsYXRlZC1lcnJvcnMvI3VwZGF0aW5nLXlvdXItY25pLXBsdWdpbnMtYW5kLWNuaS1jb25maWctZmlsZXM=&#34;&gt;https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/#updating-your-cni-plugins-and-cni-config-files&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;首先可以查看 当前的  &lt;code&gt;containerd&lt;/code&gt;  的版本.&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[root@k8s-master-01 ~]&lt;span class=&#34;comment&#34;&gt;# containerd -v&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;containerd github.com/containerd/containerd v1.6.4 212e8b6fa2f44b9c21b2798135fc6fb7c53efc16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;不在  &lt;code&gt;v1.6.0-v1.6.3&lt;/code&gt;  中。 文档中说 在  &lt;code&gt;v1.6.4&lt;/code&gt;  版本中已经修复了这个问题.&lt;/p&gt;
&lt;p&gt;查看  &lt;code&gt;/etc/cni/net.d/10-containerd-net.conflist&lt;/code&gt;  这个文件， cni 版本  &lt;code&gt; &amp;quot;cniVersion&amp;quot;: &amp;quot;1.0.0&amp;quot;,&lt;/code&gt; , 也确实是 &lt;code&gt;1.0.0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;继续搜索&lt;/p&gt;
&lt;p&gt;在 &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2NvbnRhaW5lcmQvY29udGFpbmVyZC9pc3N1ZXMvNjg3Ng==&#34;&gt;https://github.com/containerd/containerd/issues/6876&lt;/span&gt; 中，有一个人遇到了  &lt;code&gt;v1.6.4&lt;/code&gt;  版本中出现了  &lt;code&gt;incompatible CNI versions&lt;/code&gt;  这个问题。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://fangjiaxiaobai.github.io/images/k8s/01-02.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;仔细看他的这个问题，是我遇到的这个问题是一样的  &lt;code&gt;plugins type=&#39;bridge&#39;&lt;/code&gt; . 而这个  &lt;code&gt;issure&lt;/code&gt;  中提到的问题，是当  &lt;code&gt;plugins type = &#39;loooback&#39;&lt;/code&gt; . 这也是上图中  &lt;code&gt;hakman&lt;/code&gt;  提到的。&lt;/p&gt;
&lt;p&gt;仔细看  &lt;code&gt;mikebrow&lt;/code&gt;  所说的，需要安装一个  &lt;code&gt;1.0.0&lt;/code&gt;  版本的  &lt;code&gt;bridge&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;那就在网络中搜索 :  &lt;code&gt;k8s 是安装 bridge&lt;/code&gt; ， 在  &lt;code&gt;https://blog.csdn.net/m0_48594855/article/details/107870839&lt;/code&gt;  看到 安装 bridge 的方法，他这里是使用 git 仓库 源码编译。其实直接打开 git 仓库  &lt;code&gt;https://github.com/containernetworking/plugins/releases/tag/v1.1.1&lt;/code&gt;  下载对应版本即可， 今天是  &lt;code&gt;2022&lt;/code&gt;  年 &lt;code&gt;7&lt;/code&gt;  月 &lt;code&gt;22&lt;/code&gt;  日，我就下载了最新的一版本。&lt;/p&gt;
&lt;p&gt;简单粗暴的  &lt;code&gt;/opt/cni/bin/&lt;/code&gt;  下的内容，全部替换掉，然后重启  &lt;code&gt;kubelet&lt;/code&gt;  服务就可以了。&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 下载包&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 备份一下驱动&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mv /opt/cni/bin /opt/cni/bin.bak&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 解压到指定目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxvf cni-plugins-linux-amd64-v1.1.1.tgz -C /opt/cni/bin &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 重启 kubelet&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart kubelet&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后再所有的节点上都执行一遍上面的内容，然后就可以了。&lt;/p&gt;
&lt;p&gt;可以通过   &lt;code&gt;kubectl describe pod&lt;/code&gt;  查看下是否开始下载镜像了。&lt;/p&gt;
&lt;h3 id=&#34;问题解决思路&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#问题解决思路&#34;&gt;#&lt;/a&gt; 问题解决思路&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;先看下  &lt;code&gt;contrainerd&lt;/code&gt;  版本是否  &lt;code&gt;&amp;gt;=1.6.4&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;如果  &lt;code&gt;&amp;lt;=1.6.3&lt;/code&gt;  那么就需要升级  &lt;code&gt;contrainerd&lt;/code&gt;  运行环境.&lt;/li&gt;
&lt;li&gt;如果还有这样的问题，那就是要看下对应的插件类型是否满足版本要求了。&lt;/li&gt;
&lt;li&gt;如果不满足，那就重新安装下对应的插件就行了，比如我的问题中的  &lt;code&gt;bridge&lt;/code&gt;  插件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;举一反三&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#举一反三&#34;&gt;#&lt;/a&gt; 举一反三&lt;/h3&gt;
&lt;p&gt;假设有一棵树，那个问题只是这棵树的一片叶子， 这里面还涉及到很多  &lt;code&gt;k8s&lt;/code&gt;  的概念性的东西。比如  &lt;code&gt;CNI&lt;/code&gt;  网络插件都有什么，每种插件的功能是什么，以及对应的网络驱动是什么，比如  &lt;code&gt;Calico&lt;/code&gt;  ,  &lt;code&gt;fannel&lt;/code&gt;  ,  &lt;code&gt;bridge&lt;/code&gt;  。  &lt;code&gt;CNI&lt;/code&gt;  和  &lt;code&gt;containerd&lt;/code&gt; ,  &lt;code&gt;cri-o&lt;/code&gt;  都是什么关系。所以，要从根儿上去理解这些概念。 废话不多说，下篇文章见。&lt;/p&gt;
&lt;h3 id=&#34;参考文档&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#参考文档&#34;&gt;#&lt;/a&gt; 参考文档&lt;/h3&gt;
&lt;p&gt;1、&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2NvbnRhaW5lcmQvY29udGFpbmVyZC9pc3N1ZXMvNjg3Ng==&#34;&gt;https://github.com/containerd/containerd/issues/6876&lt;/span&gt;&lt;br&gt;
2、&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ4NTk0ODU1L2FydGljbGUvZGV0YWlscy8xMDc4NzA4Mzk=&#34;&gt;https://blog.csdn.net/m0_48594855/article/details/107870839&lt;/span&gt;&lt;br&gt;
3、&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2NvbnRhaW5lcm5ldHdvcmtpbmcvcGx1Z2lucy9yZWxlYXNlcy90YWcvdjEuMS4x&#34;&gt;https://github.com/containernetworking/plugins/releases/tag/v1.1.1&lt;/span&gt;&lt;br&gt;
4、&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLWNuL2RvY3MvdGFza3MvYWRtaW5pc3Rlci1jbHVzdGVyL21pZ3JhdGluZy1mcm9tLWRvY2tlcnNoaW0vdHJvdWJsZXNob290aW5nLWNuaS1wbHVnaW4tcmVsYXRlZC1lcnJvcnMvI3VwZGF0aW5nLXlvdXItY25pLXBsdWdpbnMtYW5kLWNuaS1jb25maWctZmlsZXM=&#34;&gt;https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/#updating-your-cni-plugins-and-cni-config-files&lt;/span&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://fangjiaxiaobai.github.io/2022/07/17/k8s/seris02-how-to-build/</guid>
            <title>k8s-搭建K8s集群</title>
            <link>https://fangjiaxiaobai.github.io/2022/07/17/k8s/seris02-how-to-build/</link>
            <category>k8s</category>
            <category>kubernetes</category>
            <pubDate>Sun, 17 Jul 2022 18:18:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;使用  &lt;code&gt;kubeadm 1.24.3&lt;/code&gt;  搭建  &lt;code&gt;k8s&lt;/code&gt;  集群&lt;/p&gt;
&lt;h2 id=&#34;环境准备&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#环境准备&#34;&gt;#&lt;/a&gt; 环境准备&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Centos8&lt;/code&gt;  三台.&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;k8s-master-01 192.168.0.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;k8s-node-01   192.168.0.20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;k8s-node-02   192.168.0.21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意，这三台机器不要做任何配置，尤其不要安装  &lt;code&gt;docker&lt;/code&gt; , 因为从 &lt;code&gt;k8s&lt;/code&gt;   &lt;code&gt;1.20.x&lt;/code&gt;  开始，  &lt;code&gt;kubernetes&lt;/code&gt;  弃用了  &lt;code&gt;dockershim&lt;/code&gt; , 在  &lt;code&gt;1.20.4&lt;/code&gt;  正式移除了  &lt;code&gt;dockershim&lt;/code&gt; .&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Docker support in the kubelet is now deprecated and will be removed in a future release. The kubelet uses a module called “dockershim” which implements CRI support for Docker and it has seen maintenance issues in the Kubernetes community.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;原文地址: &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2t1YmVybmV0ZXMva3ViZXJuZXRlcy9ibG9iL21hc3Rlci9DSEFOR0VMT0cvQ0hBTkdFTE9HLTEuMjAubWQjZGVwcmVjYXRpb24=&#34;&gt;kubernetes 1.20 变更日志&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;但是  &lt;code&gt;kubernetes&lt;/code&gt;  是支持符合为  &lt;code&gt;Kubernetes&lt;/code&gt;  创建的容器运行接口  &lt;code&gt;Container Runtime Interface (CRI)&lt;/code&gt;  的运行时。  &lt;code&gt;Docker&lt;/code&gt;  构建的镜像，将在你的集群的所有运行时中继续工作，一如既往。&lt;/p&gt;
&lt;h3 id=&#34;设置系统主机名以及host文件的相互解析&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#设置系统主机名以及host文件的相互解析&#34;&gt;#&lt;/a&gt; 设置系统主机名以及 host 文件的相互解析&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;hostnamectl set-hostname k8s-master-01&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;安装依赖包&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装依赖包&#34;&gt;#&lt;/a&gt; 安装依赖包&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;yum install -y conntrack ipvsadm ipset jq iptables curl sysstat libseccomp wget vim net-tools git&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum install -y chrony &lt;span class=&#34;comment&#34;&gt;# 配置时间同步&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;关闭防火墙&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#关闭防火墙&#34;&gt;#&lt;/a&gt; 关闭防火墙&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl stop firewalld &amp;amp;&amp;amp; systemctl &lt;span class=&#34;built_in&#34;&gt;disable&lt;/span&gt; firewalld&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;关闭selinux&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#关闭selinux&#34;&gt;#&lt;/a&gt; 关闭 &lt;code&gt;SELinux&lt;/code&gt;&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;swapoff -a &amp;amp;&amp;amp; sed -i &lt;span class=&#34;string&#34;&gt;&amp;#x27;/ swap / s/^\(.*\)$/#\1/g&amp;#x27;&lt;/span&gt; /etc/fstab&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;setenforce 0 &amp;amp;&amp;amp; sed -i &lt;span class=&#34;string&#34;&gt;&amp;#x27;s/^SELINUX=.*/SELINUX=disabled/&amp;#x27;&lt;/span&gt; /etc/selinux/config&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;调整内核参数&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#调整内核参数&#34;&gt;#&lt;/a&gt; 调整内核参数&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;gt; kubernetes.conf &amp;lt;&amp;lt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.bridge.bridge-nf-call-iptables=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.bridge.bridge-nf-call-ip6tables=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.ipv4.ip_forward=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.ipv4.tcp_tw_recycle=0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;vm.swappiness=0 # 禁止使用 swap 空间，只有当系统 OOM 时才允许使用它&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;vm.overcommit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;_&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;memory=1 # 不检查物理内存是否够用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;vm.panic_on_oom=0 # 开启 OOM&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;fs.inotify.max_user_instances=8192&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;fs.inotify.max_user_watches=1048576&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;fs.file-max=52706963&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;fs.nr&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;_&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;open=52706963&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.ipv6.conf.all.disable_ipv6=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.netfilter.nf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;_&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;conntrack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;_&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;max=2310720&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cp kubernetes.conf /etc/sysctl.d/kubernetes.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sysctl -p /etc/sysctl.d/kubernetes.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;调整系统时区&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#调整系统时区&#34;&gt;#&lt;/a&gt; 调整系统时区&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 设置系统时区为 中国/上海&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;timedatectl set-timezone Asia/Shanghai&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 将当前的 UTC 时间写入硬件时钟&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;timedatectl set-local-rtc 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 重启依赖于系统时间的服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart rsyslog&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart crond&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;关闭系统不需要服务&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#关闭系统不需要服务&#34;&gt;#&lt;/a&gt; 关闭系统不需要服务&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl stop postfix &amp;amp;&amp;amp; systemctl &lt;span class=&#34;built_in&#34;&gt;disable&lt;/span&gt; postfix&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;设置-rsyslogd-和-systemd-journald&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#设置-rsyslogd-和-systemd-journald&#34;&gt;#&lt;/a&gt; 设置 rsyslogd 和 systemd journald&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mkdir /var/&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;/journal &lt;span class=&#34;comment&#34;&gt;# 持久化保存日志的目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir /etc/systemd/journald.conf.d&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;gt; /etc/systemd/journald.conf.d/99-prophet.conf &amp;lt;&amp;lt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;[Journal]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;# 持久化保存到磁盘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Storage=persistent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;# 压缩历史日志&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Compress=yes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;SyncIntervalSec=5m&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;RateLimitInterval=30s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;RateLimitBurst=1000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;# 最大占用空间 10G&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;SystemMaxUse=10G&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;# 单日志文件最大 200M&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;SystemMaxFileSize=200M&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;# 日志保存时间 2 周&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;MaxRetentionSec=2week&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;# 不将日志转发到 syslog&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;ForwardToSyslog=no&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart systemd-journald&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;安装-containerd&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装-containerd&#34;&gt;#&lt;/a&gt; 安装  &lt;code&gt;containerd&lt;/code&gt;&lt;/h3&gt;
&lt;h4 id=&#34;创建etcmodules-loaddcontainerdconf配置文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建etcmodules-loaddcontainerdconf配置文件&#34;&gt;#&lt;/a&gt; 创建 &lt;code&gt;/etc/modules-load.d/containerd.conf&lt;/code&gt;  配置文件:&lt;/h4&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;lt;&amp;lt; &lt;span class=&#34;string&#34;&gt;EOF &amp;gt; /etc/modules-load.d/containerd.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;overlay&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;br_netfilter&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行下面的命令，使其生效&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;modprobe overlay&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;modprobe br_netfilter&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;创建 &lt;code&gt;/etc/sysctl.d/99-kubernetes-cri.conf&lt;/code&gt;  配置文件：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;lt;&amp;lt; &lt;span class=&#34;string&#34;&gt;EOF &amp;gt; /etc/sysctl.d/99-kubernetes-cri.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.bridge.bridge-nf-call-ip6tables = 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.bridge.bridge-nf-call-iptables = 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.ipv4.ip_forward = 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;user.max_user_namespaces=28633&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行以下命令使配置生效:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;关闭-swap&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#关闭-swap&#34;&gt;#&lt;/a&gt; 关闭  &lt;code&gt;swap&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Kubernetes 1.8 开始要求关闭系统的 Swap，如果不关闭，默认配置下 kubelet 将无法启动。 关闭系统的 Swap 方法如下:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;swapoff -a&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改  &lt;code&gt;/etc/fstab&lt;/code&gt;  文件，注释掉  &lt;code&gt;SWAP&lt;/code&gt;  的自动挂载，使用 &lt;code&gt;free -m&lt;/code&gt;  确认 &lt;code&gt;swap&lt;/code&gt;  已经关闭。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;swappiness&lt;/code&gt;  参数调整，修改 &lt;code&gt;/etc/sysctl.d/99-kubernetes-cri.conf&lt;/code&gt;  添加下面一行：&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vm.swappiness=0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行 &lt;code&gt;sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf&lt;/code&gt;  使修改生效。&lt;/p&gt;
&lt;h4 id=&#34;安装-containerd-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装-containerd-2&#34;&gt;#&lt;/a&gt; 安装  &lt;code&gt;containerd&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;在各个服务器节点上安装容器运行时  &lt;code&gt;Containerd&lt;/code&gt;  。&lt;/p&gt;
&lt;p&gt;下载  &lt;code&gt;Containerd&lt;/code&gt;  的二进制包:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget https://github.com/containerd/containerd/releases/download/v1.6.4/cri-containerd-cni-1.6.4-linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxvf cri-containerd-cni-1.6.4-linux-amd64.tar.gz -C /&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;生成  &lt;code&gt;containerd&lt;/code&gt;  的配置文件&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p /etc/containerd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;containerd config default &amp;gt; /etc/containerd/config.toml&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改前面生成的配置文件  &lt;code&gt;/etc/containerd/config.toml&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[plugins.&lt;span class=&#34;string&#34;&gt;&amp;quot;io.containerd.grpc.v1.cri&amp;quot;&lt;/span&gt;.containerd.runtimes.runc]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  [plugins.&lt;span class=&#34;string&#34;&gt;&amp;quot;io.containerd.grpc.v1.cri&amp;quot;&lt;/span&gt;.containerd.runtimes.runc.options]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SystemdCgroup = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;再修改 /etc/containerd/config.toml 中的&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[plugins.&lt;span class=&#34;string&#34;&gt;&amp;quot;io.containerd.grpc.v1.cri&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;# sandbox_image = &amp;quot;k8s.gcr.io/pause:3.6&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  sandbox_image = &lt;span class=&#34;string&#34;&gt;&amp;quot;registry.aliyuncs.com/google_containers/pause:3.7&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置  &lt;code&gt;containerd&lt;/code&gt;  开机启动，并启动  &lt;code&gt;containerd&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl &lt;span class=&#34;built_in&#34;&gt;enable&lt;/span&gt; containerd --now&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用 &lt;code&gt;crictl&lt;/code&gt;  测试一下，确保可以打印出版本信息并且没有错误信息输出:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;crictl version&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如下输出:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Version:  0.1.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RuntimeName:  containerd&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RuntimeVersion:  v1.6.4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RuntimeApiVersion:  v1alpha2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;配置服务器支持开启ipvs&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#配置服务器支持开启ipvs&#34;&gt;#&lt;/a&gt; 配置服务器支持开启 ipvs&lt;/h3&gt;
&lt;p&gt;执行下面的脚本&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;gt; /etc/sysconfig/modules/ipvs.modules &amp;lt;&amp;lt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;modprobe -- ip_vs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;modprobe -- ip_vs_rr&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;modprobe -- ip_vs_wrr&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;modprobe -- ip_vs_sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;modprobe -- nf_conntrack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;amp;&amp;amp; bash /etc/sysconfig/modules/ipvs.modules &amp;amp;&amp;amp; lsmod | grep -e ip_vs -e nf_conntrack&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面脚本创建了的 &lt;code&gt;/etc/sysconfig/modules/ipvs.modules&lt;/code&gt;  文件，保证在节点重启后能自动加载所需模块。 使用 &lt;code&gt;lsmod | grep -e ip_vs -e nf_conntrack&lt;/code&gt;  命令查看是否已经正确加载所需的内核模块。&lt;/p&gt;
&lt;p&gt;接下来，就可以使用  &lt;code&gt;kubeadm&lt;/code&gt;  部署  &lt;code&gt;k8s&lt;/code&gt;  集群了。&lt;/p&gt;
&lt;h2 id=&#34;安装k8s集群&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装k8s集群&#34;&gt;#&lt;/a&gt; 安装 k8s 集群&lt;/h2&gt;
&lt;p&gt;安装  &lt;code&gt;k8s&lt;/code&gt;  集群有很多种方式，这里使用  &lt;code&gt;kubeadm&lt;/code&gt;  安装&lt;/p&gt;
&lt;h3 id=&#34;安装kubeadm&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装kubeadm&#34;&gt;#&lt;/a&gt; 安装 kubeadm&lt;/h3&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;lt;&amp;lt;&lt;span class=&#34;string&#34;&gt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;[kubernetes]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;name=Kubernetes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;enabled=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;gpgcheck=0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;repo_gpgcheck=0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;EOF&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum makecache&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl &lt;span class=&#34;built_in&#34;&gt;enable&lt;/span&gt; --now kubelet&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;配置-kubeadm-配置文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#配置-kubeadm-配置文件&#34;&gt;#&lt;/a&gt; 配置  &lt;code&gt;kubeadm&lt;/code&gt;  配置文件&lt;/h3&gt;
&lt;p&gt;配置  &lt;code&gt;kubeadm&lt;/code&gt;  的配置文件.  &lt;code&gt;touch kubeadm-config.yaml&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kubeadm.k8s.io/v1beta3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;InitConfiguration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;localAPIEndpoint:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;advertiseAddress:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.96&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.151&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;bindPort:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;6443&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;nodeRegistration:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;criSocket:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;unix:///run/containerd/containerd.sock&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;taints:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;effect:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;PreferNoSchedule&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;key:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;node-role.kubernetes.io/master&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kubeadm.k8s.io/v1beta2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ClusterConfiguration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kubernetesVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;v1.24.0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;imageRepository:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;registry.aliyuncs.com/google_containers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;networking:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;podSubnet:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;10.244&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;/16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kubelet.config.k8s.io/v1beta1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;KubeletConfiguration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;cgroupDriver:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;systemd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;failSwapOn:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;apiVersion:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;kubeproxy.config.k8s.io/v1alpha1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;kind:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;KubeProxyConfiguration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;mode:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;ipvs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里定制了 &lt;code&gt;imageRepository&lt;/code&gt;  为阿里云的 &lt;code&gt;registry&lt;/code&gt; ，避免因 gcr 被墙，无法直接拉取镜像。 &lt;code&gt;criSocket&lt;/code&gt;  设置了容器运行时为 &lt;code&gt;containerd&lt;/code&gt; 。 同时设置 &lt;code&gt;kubelet&lt;/code&gt;  的 &lt;code&gt;cgroupDriver&lt;/code&gt;  为 &lt;code&gt;systemd&lt;/code&gt; ，设置 &lt;code&gt;kube-proxy&lt;/code&gt;  代理模式为 &lt;code&gt;ipvs&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;可以通过  &lt;code&gt;kubeadm config print init-defaults --component-configs KubeletConfiguration&lt;/code&gt;  可以打印集群初始化默认的使用的配置.&lt;/p&gt;
&lt;p&gt;在开始初始化集群之前可以使用 &lt;code&gt;kubeadm config images pull --config kubeadm-config.yaml&lt;/code&gt;  预先在各个服务器节点上拉取所 &lt;code&gt;k8s&lt;/code&gt;  需要的容器镜像。&lt;/p&gt;
&lt;h3 id=&#34;初始化-k8s-master节点&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#初始化-k8s-master节点&#34;&gt;#&lt;/a&gt; 初始化  &lt;code&gt;k8s&lt;/code&gt;   &lt;code&gt;master&lt;/code&gt;  节点&lt;/h3&gt;
&lt;p&gt;在  &lt;code&gt;master&lt;/code&gt;  节点上执行  &lt;code&gt;kubeadm init --config kubeadm-config.yaml&lt;/code&gt; ,&lt;/p&gt;
&lt;p&gt;看到最后有打印：  &lt;code&gt;Your Kubernetes control-plane has initialized successfully!&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;就说明执行成功了。&lt;/p&gt;
&lt;p&gt;然后还有提示:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;To start using your cluster, you need to run the following as a regular user:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  mkdir -p &lt;span class=&#34;variable&#34;&gt;$HOME&lt;/span&gt;/.kube&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  sudo cp -i /etc/kubernetes/admin.conf &lt;span class=&#34;variable&#34;&gt;$HOME&lt;/span&gt;/.kube/config&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  sudo chown $(id -u):$(id -g) &lt;span class=&#34;variable&#34;&gt;$HOME&lt;/span&gt;/.kube/config&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Alternatively, &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; you are the root user, you can run:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;export&lt;/span&gt; KUBECONFIG=/etc/kubernetes/admin.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;You should now deploy a pod network to the cluster.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Run &lt;span class=&#34;string&#34;&gt;&amp;quot;kubectl apply -f [podnetwork].yaml&amp;quot;&lt;/span&gt; with one of the options listed at:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  https://kubernetes.io/docs/concepts/cluster-administration/addons/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Then you can join any number of worker nodes by running the following on each as root:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubeadm join 192.168.0.10:6443 --token e0nvot.l8sgzcgl07d5baq6 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	--discovery-token-ca-cert-hash sha256:d07d9a5b919c23177881134e3ccf90e26fcb173133b8f6172cbf3d74f3c6a75d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;所以，我们按照提示执行。&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p &lt;span class=&#34;variable&#34;&gt;$HOME&lt;/span&gt;/.kube&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo cp -i /etc/kubernetes/admin.conf &lt;span class=&#34;variable&#34;&gt;$HOME&lt;/span&gt;/.kube/config&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo chown $(id -u):$(id -g) &lt;span class=&#34;variable&#34;&gt;$HOME&lt;/span&gt;/.kube/config&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后再 两台 &lt;code&gt;node&lt;/code&gt;  节点上执行 如下命令来加入到集群中。&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubeadm join 192.168.0.10:6443 --token e0nvot.l8sgzcgl07d5baq6 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	--discovery-token-ca-cert-hash sha256:d07d9a5b919c23177881134e3ccf90e26fcb173133b8f6172cbf3d74f3c6a75d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看一下集群状态，确认个组件都处于 &lt;code&gt;healthy&lt;/code&gt;  状态，是否有错误:&lt;/p&gt;
&lt;figure class=&#34;highlight sh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl get cs&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Warning: v1 ComponentStatus is deprecated &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; v1.19+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;NAME                 STATUS    MESSAGE                         ERROR&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;scheduler            Healthy   ok&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;controller-manager   Healthy   ok&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcd-0               Healthy   &amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;health&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;reason&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;集群初始化如果遇到问题，可以使用 kubeadm reset 命令进行清理.&lt;/p&gt;
&lt;p&gt;这样 &lt;code&gt;k8s&lt;/code&gt;  集群就部署完成了。&lt;/p&gt;
&lt;h2 id=&#34;最后&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#最后&#34;&gt;#&lt;/a&gt; 最后&lt;/h2&gt;
&lt;p&gt;希望和你一起遇见更好的自己&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/ml/qrcode.jpg&#34; alt=&#34;qrcode&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
